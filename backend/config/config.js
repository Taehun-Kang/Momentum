require('dotenv').config();

/**
 * ğŸ”§ YouTube AI ì„œë¹„ìŠ¤ í†µí•© ì„¤ì • íŒŒì¼
 * 
 * ì´ íŒŒì¼ì€ YouTube Shorts íë ˆì´ì…˜ ì„œë¹„ìŠ¤ì˜ ëª¨ë“  ì„¤ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
 * API í‚¤, í• ë‹¹ëŸ‰ ê´€ë¦¬, ìºì‹œ ì„¤ì •, ê¸°ë³¸ê°’ ë“±ì„ í¬í•¨í•©ë‹ˆë‹¤.
 * 
 * ğŸ“‹ ì„¤ì •í•´ì•¼ í•  í™˜ê²½ë³€ìˆ˜ë“¤:
 * - í•„ìˆ˜: SUPABASE_URL, SUPABASE_ANON_KEY, YOUTUBE_API_KEY
 * - ì„ íƒ: CLAUDE_API_KEY, BRIGHT_DATA_API_KEY, SERP_API_KEY
 */

const config = {
  // =============================================================================
  // ğŸŒ ì„œë²„ ê¸°ë³¸ ì„¤ì •
  // =============================================================================
  PORT: process.env.PORT || 3000,
  NODE_ENV: process.env.NODE_ENV || 'development',
  
  // =============================================================================
  // ğŸ—„ï¸ Supabase ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (í•„ìˆ˜)
  // =============================================================================
  SUPABASE_URL: process.env.SUPABASE_URL || '',
  SUPABASE_ANON_KEY: process.env.SUPABASE_ANON_KEY || '',
  SUPABASE_SERVICE_ROLE_KEY: process.env.SUPABASE_SERVICE_ROLE_KEY || '',
  
  // =============================================================================
  // ğŸ¬ YouTube API ì„¤ì • (í•„ìˆ˜)
  // í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ê¸°ëŠ¥ì¸ ì˜ìƒ ê²€ìƒ‰ê³¼ í•„í„°ë§ì— í•„ìš”
  // =============================================================================
  YOUTUBE_API_KEY: process.env.YOUTUBE_API_KEY || '',
  
  // =============================================================================
  // ğŸ” JWT ì¸ì¦ ì„¤ì •
  // ì‚¬ìš©ì ë¡œê·¸ì¸ ì„¸ì…˜ ê´€ë¦¬ìš©
  // =============================================================================
  JWT_SECRET: process.env.JWT_SECRET || 'your-secret-key-change-in-production',
  JWT_EXPIRES_IN: process.env.JWT_EXPIRES_IN || '7d',
  
  // =============================================================================
  // ğŸ¤– AI ë° ì™¸ë¶€ ì„œë¹„ìŠ¤ API ì„¤ì • (ì„ íƒì )
  // Claude: AI ëŒ€í™”í˜• ê²€ìƒ‰, Bright Data: ì›¹ ìŠ¤í¬ë˜í•‘, SERP: êµ¬ê¸€ íŠ¸ë Œë“œ
  // =============================================================================
  CLAUDE_API_KEY: process.env.CLAUDE_API_KEY || '',        // TODO: Claude Consoleì—ì„œ ë°œê¸‰
  BRIGHT_DATA_API_KEY: process.env.BRIGHT_DATA_API_KEY || '', // TODO: brightdata.comì—ì„œ ë°œê¸‰
  SERP_API_KEY: process.env.SERP_API_KEY || '',            // TODO: serpapi.comì—ì„œ ë°œê¸‰
  
  // =============================================================================
  // ğŸ“Š API í• ë‹¹ëŸ‰ ê´€ë¦¬ ì‹œìŠ¤í…œ
  // ê° API ì„œë¹„ìŠ¤ì˜ ì‚¬ìš©ëŸ‰ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ì œí•œí•˜ì—¬ ë¹„ìš© ì ˆì•½
  // =============================================================================
  quotaLimits: {
    // YouTube API í• ë‹¹ëŸ‰ (ë§¤ìš° ì¤‘ìš”!)
    youtube: {
      dailyLimit: 10000,          // ì¼ì¼ ìµœëŒ€ 10,000 units (Google ê¸°ë³¸ í• ë‹¹ëŸ‰)
      warningThreshold: 8000,     // 8,000 units ë„ë‹¬ì‹œ ê²½ê³  (80%)
      emergencyThreshold: 9000    // 9,000 units ë„ë‹¬ì‹œ ìºì‹œ ì „ìš© ëª¨ë“œ (90%)
      // ğŸ’¡ ì™œ í•„ìš”í•œê°€? YouTube APIëŠ” ë§¤ìš° ë¹„ì‹¸ê³  í• ë‹¹ëŸ‰ì´ ì œí•œì 
      // ğŸ’¡ search.list = 100 units, videos.list = 1+ë¶€ë¶„ë‹¹2 units
      // ğŸ’¡ í•˜ë£¨ì— ì•½ 50-100íšŒ ê²€ìƒ‰ë§Œ ê°€ëŠ¥í•˜ë¯€ë¡œ ìºì‹±ì´ í•„ìˆ˜
    },
    
    // SerpAPI í• ë‹¹ëŸ‰ (êµ¬ê¸€ íŠ¸ë Œë“œìš©)
    serpApi: {
      monthlyLimit: 1000,         // ì›” 1,000íšŒ (ë¬´ë£Œ í”Œëœ ê¸°ì¤€)
      warningThreshold: 800       // 800íšŒ ë„ë‹¬ì‹œ ê²½ê³ 
      // ğŸ’¡ ì™œ í•„ìš”í•œê°€? ì‹¤ì‹œê°„ íŠ¸ë Œë“œ í‚¤ì›Œë“œ ìˆ˜ì§‘ìš©
      // ğŸ’¡ ë¬´ë£Œ í”Œëœì€ 100íšŒ/ì›”, ìœ ë£ŒëŠ” 1000íšŒ/ì›”ë¶€í„° ì‹œì‘
    },
    
    // Bright Data í• ë‹¹ëŸ‰ (ì›¹ ìŠ¤í¬ë˜í•‘ìš©)
    brightData: {
      monthlyRequests: 5000,      // ì›” 5,000íšŒ ìš”ì²­
      concurrentRequests: 10      // ë™ì‹œ ìµœëŒ€ 10ê°œ ìš”ì²­
      // ğŸ’¡ ì™œ í•„ìš”í•œê°€? ë„¤ì´ë²„, ë‹¤ìŒ ë“± í•œêµ­ ì‚¬ì´íŠ¸ íŠ¸ë Œë“œ ìˆ˜ì§‘
      // ğŸ’¡ ë¬´ë£Œ í”Œëœì€ ì œí•œì ì´ë¯€ë¡œ íš¨ìœ¨ì  ì‚¬ìš© í•„ìš”
    },
    
    // Claude API í• ë‹¹ëŸ‰ (AI ëŒ€í™”í˜• ê²€ìƒ‰ìš©)
    claude: {
      dailyRequests: 2000,        // ì¼ì¼ 2,000íšŒ ìš”ì²­
      tokensPerRequest: 4000      // ìš”ì²­ë‹¹ í‰ê·  4,000 í† í°
      // ğŸ’¡ ì™œ í•„ìš”í•œê°€? ìì—°ì–´ ì§ˆë¬¸ì„ í‚¤ì›Œë“œë¡œ ë³€í™˜
      // ğŸ’¡ í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥ì´ë¯€ë¡œ ë¬´ë£Œ ì‚¬ìš©ìëŠ” ì œí•œì ìœ¼ë¡œ ì œê³µ
    }
  },
  
  // =============================================================================
  // â° ì„¸ë¶„í™”ëœ ìºì‹œ ì„¤ì • ì‹œìŠ¤í…œ
  // ê° ë°ì´í„° íƒ€ì…ë³„ë¡œ ë‹¤ë¥¸ TTLì„ ì ìš©í•˜ì—¬ API ì‚¬ìš©ëŸ‰ ìµœì í™”
  // =============================================================================
  cache: {
    ttl: {
      // ê²€ìƒ‰ ê²°ê³¼ ìºì‹± (4ì‹œê°„)
      searchResults: 4 * 60 * 60 * 1000,
      // ğŸ’¡ ì´ìœ : ê²€ìƒ‰ ê²°ê³¼ëŠ” ìì£¼ ë°”ë€Œì§€ ì•Šì§€ë§Œ ë„ˆë¬´ ì˜¤ë˜ ìºì‹œí•˜ë©´ ìµœì‹ ì„± ë–¨ì–´ì§
      
      // íŠ¸ë Œë“œ ë°ì´í„° ìºì‹± (2ì‹œê°„)
      trendData: 2 * 60 * 60 * 1000,
      // ğŸ’¡ ì´ìœ : íŠ¸ë Œë“œëŠ” ë¹ ë¥´ê²Œ ë³€í•˜ë¯€ë¡œ ì§§ì€ ìºì‹œ
      
      // ì˜ìƒ ìƒì„¸ ì •ë³´ ìºì‹± (24ì‹œê°„)
      videoDetails: 24 * 60 * 60 * 1000,
      // ğŸ’¡ ì´ìœ : ì˜ìƒ ì œëª©, ì„¤ëª… ë“±ì€ ì˜ ë°”ë€Œì§€ ì•ŠìŒ
      
      // ì‚¬ìš©ì ì„ í˜¸ë„ ìºì‹± (7ì¼)
      userPreferences: 7 * 24 * 60 * 60 * 1000,
      // ğŸ’¡ ì´ìœ : ì‚¬ìš©ì ì·¨í–¥ì€ ì²œì²œíˆ ë³€í•˜ë¯€ë¡œ ê¸´ ìºì‹œ
      
      // ì¬ìƒ ê°€ëŠ¥ ì˜ìƒ ìºì‹± (7ì¼) - ì¤‘ìš”!
      playableVideos: 7 * 24 * 60 * 60 * 1000,
      // ğŸ’¡ ì´ìœ : ì¬ìƒ ê°€ëŠ¥í•œ ì˜ìƒì€ ìƒíƒœê°€ ì˜ ë°”ë€Œì§€ ì•ŠìŒ
      
      // ì¬ìƒ ë¶ˆê°€ ì˜ìƒ ìºì‹± (1ì¼) - ì¤‘ìš”!
      unplayableVideos: 24 * 60 * 60 * 1000
      // ğŸ’¡ ì´ìœ : ì¬ìƒ ë¶ˆê°€ ì˜ìƒì„ ë‹¤ì‹œ í™•ì¸í•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ì—¬ API ì ˆì•½
    },
    maxSize: 1000,                    // ìµœëŒ€ 1000ê°œ í•­ëª© ìºì‹œ
    cleanupInterval: 60 * 60 * 1000   // 1ì‹œê°„ë§ˆë‹¤ ë§Œë£Œëœ ìºì‹œ ì •ë¦¬
  },
  
  // =============================================================================
  // ğŸ¯ YouTube ê²€ìƒ‰ ê¸°ë³¸ ì„¤ì • (í•œêµ­ ìµœì í™”)
  // ëª¨ë“  ê²€ìƒ‰ì— ê¸°ë³¸ì ìœ¼ë¡œ ì ìš©ë˜ëŠ” ì„¤ì •ë“¤
  // =============================================================================
  defaults: {
    maxResults: 20,           // ê¸°ë³¸ ê²€ìƒ‰ ê²°ê³¼ ìˆ˜
    regionCode: 'KR',         // í•œêµ­ ì§€ì—­ ì„¤ì • (í•œêµ­ ì‚¬ìš©ì ë§ì¶¤)
    language: 'ko',           // í•œêµ­ì–´ ìš°ì„ 
    videoDuration: 'short',   // Shortsë§Œ ê²€ìƒ‰ (4ë¶„ ë¯¸ë§Œ)
    safeSearch: 'moderate'    // ì¤‘ê°„ ìˆ˜ì¤€ ì•ˆì „ ê²€ìƒ‰
    // ğŸ’¡ ì´ìœ : í•œêµ­ ì‚¬ìš©ìë¥¼ ìœ„í•œ YouTube Shorts ì„œë¹„ìŠ¤ì´ë¯€ë¡œ
  },
  
  // =============================================================================
  // ğŸ›¡ï¸ ë³´ì•ˆ ë° ì œí•œ ì„¤ì •
  // =============================================================================
  
  // ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ… (API ë‚¨ìš© ë°©ì§€)
  RATE_LIMIT_WINDOW_MS: 15 * 60 * 1000, // 15ë¶„ ìœˆë„ìš°
  RATE_LIMIT_MAX_REQUESTS: 100,         // 15ë¶„ë‹¹ ìµœëŒ€ 100íšŒ ìš”ì²­
  
  // CORS ì„¤ì • (í”„ë¡ íŠ¸ì—”ë“œ ì—°ê²°)
  CORS_ORIGIN: process.env.CORS_ORIGIN || 'http://localhost:3001',
  
  // API ë²„ì „ ê´€ë¦¬
  API_PREFIX: '/api/v1',
  
  // ë¡œê·¸ ë ˆë²¨
  LOG_LEVEL: process.env.LOG_LEVEL || 'info'
};

// =============================================================================
// ğŸ” í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ ì‹œìŠ¤í…œ
// =============================================================================

// í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ (ì—†ìœ¼ë©´ ì„œë¹„ìŠ¤ ì‹¤í–‰ ë¶ˆê°€)
const requiredEnvVars = [
  'SUPABASE_URL',        // ì‚¬ìš©ì ë°ì´í„°, ìºì‹œ ì €ì¥ìš©
  'SUPABASE_ANON_KEY',   // Supabase ì ‘ê·¼ìš©
  'YOUTUBE_API_KEY'      // í•µì‹¬ ê¸°ëŠ¥ì¸ ì˜ìƒ ê²€ìƒ‰ìš©
];

// ì„ íƒì  í™˜ê²½ ë³€ìˆ˜ (ì—†ì–´ë„ ë˜ì§€ë§Œ ê¸°ëŠ¥ ì œí•œ)
const optionalEnvVars = [
  'CLAUDE_API_KEY',      // AI ëŒ€í™”í˜• ê²€ìƒ‰ (í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥)
  'BRIGHT_DATA_API_KEY', // ì›¹ ìŠ¤í¬ë˜í•‘ (íŠ¸ë Œë“œ ìˆ˜ì§‘)
  'SERP_API_KEY'         // êµ¬ê¸€ íŠ¸ë Œë“œ (ì‹¤ì‹œê°„ íŠ¸ë Œë“œ)
];

/**
 * ğŸ” ì„¤ì • ê²€ì¦ í•¨ìˆ˜
 * í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³ , ëˆ„ë½ëœ ê²ƒì´ ìˆìœ¼ë©´ ì˜¤ë¥˜ ì¶œë ¥
 */
function validateConfig() {
  const missingVars = requiredEnvVars.filter(varName => !process.env[varName]);
  const missingOptional = optionalEnvVars.filter(varName => !process.env[varName]);
  
  // í•„ìˆ˜ ë³€ìˆ˜ ëˆ„ë½ ì‹œ
  if (missingVars.length > 0) {
    console.error('âŒ ëˆ„ë½ëœ í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜:');
    missingVars.forEach(varName => console.error(`   - ${varName}`));
    console.error('\nğŸ’¡ .env íŒŒì¼ì„ ìƒì„±í•˜ê³  í•„ìˆ˜ ë³€ìˆ˜ë“¤ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
    console.error('\nğŸ“‹ ì„¤ì • ë°©ë²•:');
    console.error('   1. .env íŒŒì¼ ìƒì„±');
    console.error('   2. YOUTUBE_API_KEY=your_api_key_here');
    console.error('   3. SUPABASE_URL=your_supabase_url');
    console.error('   4. SUPABASE_ANON_KEY=your_anon_key');
    
    if (config.NODE_ENV === 'production') {
      process.exit(1);
    }
  }
  
  // ì„ íƒì  ë³€ìˆ˜ ëˆ„ë½ ì‹œ (ê²½ê³ ë§Œ)
  if (missingOptional.length > 0) {
    console.warn('âš ï¸ ëˆ„ë½ëœ ì„ íƒì  í™˜ê²½ ë³€ìˆ˜ (ì¼ë¶€ ê¸°ëŠ¥ ì œí•œë¨):');
    missingOptional.forEach(varName => {
      const description = getEnvVarDescription(varName);
      console.warn(`   - ${varName}: ${description}`);
    });
    console.warn('\nğŸ’¡ ì´ ë³€ìˆ˜ë“¤ì´ ì—†ì–´ë„ ê¸°ë³¸ ê¸°ëŠ¥ì€ ë™ì‘í•˜ì§€ë§Œ, ê³ ê¸‰ ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤.');
  }
}

/**
 * ğŸ” í™˜ê²½ ë³€ìˆ˜ ì„¤ëª… ë°˜í™˜
 */
function getEnvVarDescription(varName) {
  const descriptions = {
    'CLAUDE_API_KEY': 'AI ëŒ€í™”í˜• ê²€ìƒ‰ ê¸°ëŠ¥ (í”„ë¦¬ë¯¸ì—„)',
    'BRIGHT_DATA_API_KEY': 'ì›¹ ìŠ¤í¬ë˜í•‘ì„ í†µí•œ íŠ¸ë Œë“œ ìˆ˜ì§‘',
    'SERP_API_KEY': 'êµ¬ê¸€ íŠ¸ë Œë“œ ì‹¤ì‹œê°„ ìˆ˜ì§‘'
  };
  return descriptions[varName] || 'ì•Œ ìˆ˜ ì—†ëŠ” ê¸°ëŠ¥';
}

/**
 * ğŸ¯ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥ í™•ì¸
 * ì„¤ì •ëœ API í‚¤ì— ë”°ë¼ ì–´ë–¤ ê¸°ëŠ¥ë“¤ì´ ì‚¬ìš© ê°€ëŠ¥í•œì§€ ë°˜í™˜
 */
function getAvailableFeatures() {
  const features = {
    youtubeSearch: !!config.YOUTUBE_API_KEY,     // YouTube ê²€ìƒ‰ (í•„ìˆ˜)
    videoFiltering: !!config.YOUTUBE_API_KEY,    // ì˜ìƒ í•„í„°ë§ (í•„ìˆ˜)
    googleTrends: !!config.SERP_API_KEY,         // êµ¬ê¸€ íŠ¸ë Œë“œ (ì„ íƒ)
    webScraping: !!config.BRIGHT_DATA_API_KEY,   // ì›¹ ìŠ¤í¬ë˜í•‘ (ì„ íƒ)
    aiOptimization: !!config.CLAUDE_API_KEY      // AI ìµœì í™” (ì„ íƒ)
  };
  
  // ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥ ë¡œê·¸ ì¶œë ¥
  console.log('\nğŸ¯ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥:');
  Object.entries(features).forEach(([feature, available]) => {
    const status = available ? 'âœ…' : 'âŒ';
    const description = getFeatureDescription(feature);
    console.log(`   ${status} ${feature}: ${description}`);
  });
  
  return features;
}

/**
 * ğŸ” ê¸°ëŠ¥ ì„¤ëª… ë°˜í™˜
 */
function getFeatureDescription(feature) {
  const descriptions = {
    'youtubeSearch': 'YouTube ì˜ìƒ ê²€ìƒ‰',
    'videoFiltering': 'ì¬ìƒ ê°€ëŠ¥ ì˜ìƒ í•„í„°ë§', 
    'googleTrends': 'êµ¬ê¸€ íŠ¸ë Œë“œ í‚¤ì›Œë“œ ìˆ˜ì§‘',
    'webScraping': 'ë„¤ì´ë²„/ë‹¤ìŒ íŠ¸ë Œë“œ ìˆ˜ì§‘',
    'aiOptimization': 'AI ëŒ€í™”í˜• ê²€ìƒ‰ ë° ìµœì í™”'
  };
  return descriptions[feature] || 'ì•Œ ìˆ˜ ì—†ëŠ” ê¸°ëŠ¥';
}

/**
 * ğŸ“‹ TODO: ë‚˜ì¤‘ì— ì„¤ì •í•´ì•¼ í•  í•­ëª©ë“¤
 * 
 * 1. ğŸ”‘ API í‚¤ ë°œê¸‰ ë° ì„¤ì •:
 *    - CLAUDE_API_KEY: console.anthropic.comì—ì„œ ë°œê¸‰
 *    - BRIGHT_DATA_API_KEY: brightdata.comì—ì„œ ë°œê¸‰  
 *    - SERP_API_KEY: serpapi.comì—ì„œ ë°œê¸‰
 * 
 * 2. ğŸ“Š í• ë‹¹ëŸ‰ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬í˜„:
 *    - API ì‚¬ìš©ëŸ‰ ì‹¤ì‹œê°„ ì¶”ì 
 *    - ì„ê³„ì¹˜ ë„ë‹¬ì‹œ ì•Œë¦¼ ì‹œìŠ¤í…œ
 *    - ìë™ ìºì‹œ ì „ìš© ëª¨ë“œ ì „í™˜
 * 
 * 3. ğŸ—„ï¸ ìºì‹œ ì €ì¥ì†Œ ì„ íƒ:
 *    - ê°œë°œ: ë©”ëª¨ë¦¬ ìºì‹œ (í˜„ì¬)
 *    - ìš´ì˜: Redis ë˜ëŠ” Supabase í…Œì´ë¸”
 * 
 * 4. ğŸ”§ ë™ì  ì„¤ì • ê´€ë¦¬:
 *    - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œì—ì„œ í• ë‹¹ëŸ‰ ì¡°ì •
 *    - ìºì‹œ TTL ë™ì  ë³€ê²½
 *    - ê¸°ëŠ¥ë³„ ON/OFF í† ê¸€
 */

module.exports = {
  config,
  validateConfig,
  getAvailableFeatures
}; 