<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸŒŠ Momentum API í…ŒìŠ¤íŠ¸ í˜ì´ì§€ - Wave Team</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        opacity: 0.9;
        font-size: 1.1rem;
      }

      .content {
        padding: 30px;
      }

      .api-section {
        margin-bottom: 30px;
        border: 2px solid #f0f0f0;
        border-radius: 15px;
        padding: 20px;
        transition: all 0.3s ease;
      }

      .api-section:hover {
        border-color: #667eea;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
      }

      .api-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
      }

      .api-title .emoji {
        margin-right: 10px;
        font-size: 1.5rem;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        min-width: 120px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn.small {
        padding: 8px 15px;
        font-size: 12px;
        min-width: 100px;
      }

      .input-group {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        align-items: center;
      }

      .input-group input {
        padding: 10px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        flex: 1;
        max-width: 300px;
      }

      .input-group input:focus {
        outline: none;
        border-color: #667eea;
      }

      .result-area {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-top: 15px;
        font-family: "Monaco", "Menlo", monospace;
        font-size: 12px;
        line-height: 1.5;
        max-height: 400px;
        overflow-y: auto;
        white-space: pre-wrap;
        border: 1px solid #e0e0e0;
      }

      .loading {
        color: #667eea;
        font-style: italic;
      }

      .error {
        color: #dc3545;
        background: #f8d7da;
        border-color: #f5c6cb;
      }

      .success {
        color: #155724;
        background: #d4edda;
        border-color: #c3e6cb;
      }

      .status-indicator {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-online {
        background: #28a745;
      }

      .status-offline {
        background: #dc3545;
      }

      .clear-btn {
        background: #6c757d;
        float: right;
        padding: 5px 10px;
        font-size: 11px;
        margin-left: 10px;
      }

      .footer {
        text-align: center;
        padding: 20px;
        color: #666;
        border-top: 1px solid #f0f0f0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>ğŸŒŠ Momentum API í…ŒìŠ¤íŠ¸</h1>
        <p>YouTube Shorts AI íë ˆì´ì…˜ ì„œë¹„ìŠ¤ - Wave Team</p>
      </div>

      <div class="content">
        <!-- ì„œë²„ ìƒíƒœ í™•ì¸ -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">ğŸ¥</span>
            ì„œë²„ ìƒíƒœ í™•ì¸
          </div>
          <div class="button-group">
            <button class="btn" onclick="checkServerHealth()">
              ì„œë²„ í—¬ìŠ¤ì²´í¬
            </button>
            <button class="btn" onclick="checkApiInfo()">API ì •ë³´</button>
            <button class="btn" onclick="checkYouTubeStatus()">
              YouTube ì„œë¹„ìŠ¤ ìƒíƒœ
            </button>
          </div>
          <div id="status-result" class="result-area">
            ì—¬ê¸°ì— ì„œë²„ ìƒíƒœ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>

        <!-- Shorts ê²€ìƒ‰ -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">ğŸ”</span>
            Shorts ì˜ìƒ ê²€ìƒ‰
          </div>
          <div class="input-group">
            <input
              type="text"
              id="search-query"
              placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: funny, music, gaming)"
              value="funny"
            />
            <input
              type="number"
              id="search-max"
              placeholder="ê²°ê³¼ ìˆ˜"
              value="5"
              min="1"
              max="50"
            />
            <select id="search-order">
              <option value="relevance">ê´€ë ¨ë„</option>
              <option value="date">ìµœì‹ ìˆœ</option>
              <option value="viewCount">ì¡°íšŒìˆ˜</option>
            </select>
          </div>
          <div class="button-group">
            <button class="btn" onclick="searchShorts()">ê²€ìƒ‰í•˜ê¸°</button>
            <button class="btn small" onclick="searchPreset('funny')">
              ì¬ë¯¸ìˆëŠ” ì˜ìƒ
            </button>
            <button class="btn small" onclick="searchPreset('music')">
              ìŒì•…
            </button>
            <button class="btn small" onclick="searchPreset('gaming')">
              ê²Œì´ë°
            </button>
          </div>
          <div id="search-result" class="result-area">
            ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>

        <!-- ì¸ê¸° Shorts -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">ğŸ”¥</span>
            ì¸ê¸° Shorts ì˜ìƒ
          </div>
          <div class="input-group">
            <input
              type="number"
              id="trending-max"
              placeholder="ê²°ê³¼ ìˆ˜"
              value="10"
              min="1"
              max="50"
            />
            <select id="trending-region">
              <option value="US">ë¯¸êµ­</option>
              <option value="KR">í•œêµ­</option>
              <option value="JP">ì¼ë³¸</option>
              <option value="GB">ì˜êµ­</option>
            </select>
          </div>
          <div class="button-group">
            <button class="btn" onclick="getTrendingShorts()">
              ì¸ê¸° ì˜ìƒ ê°€ì ¸ì˜¤ê¸°
            </button>
          </div>
          <div id="trending-result" class="result-area">
            ì¸ê¸° ì˜ìƒ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ë³„ Shorts -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">ğŸ“‚</span>
            ì¹´í…Œê³ ë¦¬ë³„ Shorts
          </div>
          <div class="input-group">
            <input
              type="number"
              id="category-max"
              placeholder="ê²°ê³¼ ìˆ˜"
              value="8"
              min="1"
              max="50"
            />
          </div>
          <div class="button-group">
            <button class="btn small" onclick="getByCategory('comedy')">
              ì½”ë¯¸ë””
            </button>
            <button class="btn small" onclick="getByCategory('music')">
              ìŒì•…
            </button>
            <button class="btn small" onclick="getByCategory('gaming')">
              ê²Œì´ë°
            </button>
            <button class="btn small" onclick="getByCategory('education')">
              êµìœ¡
            </button>
            <button class="btn small" onclick="getByCategory('lifestyle')">
              ë¼ì´í”„ìŠ¤íƒ€ì¼
            </button>
            <button class="btn small" onclick="getByCategory('food')">
              ìŒì‹
            </button>
            <button class="btn small" onclick="getByCategory('sports')">
              ìŠ¤í¬ì¸ 
            </button>
            <button class="btn small" onclick="getByCategory('tech')">
              ê¸°ìˆ 
            </button>
          </div>
          <div id="category-result" class="result-area">
            ì¹´í…Œê³ ë¦¬ë³„ ì˜ìƒì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>

        <!-- ìºì‹œ ê´€ë¦¬ -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">ğŸ—‘ï¸</span>
            ìºì‹œ ê´€ë¦¬
          </div>
          <div class="button-group">
            <button class="btn" onclick="clearCache()">ìºì‹œ ì •ë¦¬</button>
          </div>
          <div id="cache-result" class="result-area">
            ìºì‹œ ê´€ë¦¬ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>

        <!-- ì¸ì¦ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">ğŸ”</span>
            ì¸ì¦ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
          </div>
          <div class="input-group">
            <input
              type="email"
              id="auth-email"
              placeholder="ì´ë©”ì¼ ì£¼ì†Œ"
              value="test@momentum.com"
            />
            <input
              type="password"
              id="auth-password"
              placeholder="ë¹„ë°€ë²ˆí˜¸"
              value="test123456"
            />
            <input
              type="text"
              id="auth-name"
              placeholder="ì´ë¦„"
              value="í…ŒìŠ¤íŠ¸ ìœ ì €"
            />
          </div>
          <div class="button-group">
            <button class="btn" onclick="testSignup()">
              ğŸ†• íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸
            </button>
            <button class="btn" onclick="testSignin()">ğŸ”‘ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
            <button class="btn" onclick="testMe()">ğŸ‘¤ ë‚´ ì •ë³´ ì¡°íšŒ</button>
            <button class="btn" onclick="testSignout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
          </div>
          <div id="auth-result" class="result-area">
            ì¸ì¦ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>

        <!-- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">ğŸ—„ï¸</span>
            ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
          </div>
          <div class="button-group">
            <button class="btn" onclick="testDbConnection()">
              ğŸ”Œ ì—°ê²° ìƒíƒœ í™•ì¸
            </button>
            <button class="btn" onclick="testDbQueries()">
              ğŸ” ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
            </button>
            <button class="btn" onclick="testCacheOperations()">
              ğŸ’¾ ìºì‹œ ë™ì‘ í…ŒìŠ¤íŠ¸
            </button>
            <button class="btn" onclick="testDbPerformance()">
              âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
            </button>
          </div>
          <div id="db-result" class="result-area">
            ë°ì´í„°ë² ì´ìŠ¤ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>

        <!-- API ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§ -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">ğŸ“Š</span>
            API ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
          </div>
          <div class="button-group">
            <button class="btn" onclick="getApiUsage()">
              ğŸ“ˆ í˜„ì¬ ì‚¬ìš©ëŸ‰ ì¡°íšŒ
            </button>
            <button class="btn" onclick="getQuotaStatus()">
              âš–ï¸ í• ë‹¹ëŸ‰ ìƒíƒœ í™•ì¸
            </button>
            <button class="btn" onclick="testRateLimiting()">
              ğŸš¦ Rate Limiting í…ŒìŠ¤íŠ¸
            </button>
            <button class="btn" onclick="simulateHighLoad()">
              ğŸ”¥ ë¶€í•˜ ì‹œë®¬ë ˆì´ì…˜
            </button>
          </div>
          <div id="api-usage-result" class="result-area">
            API ì‚¬ìš©ëŸ‰ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>

        <!-- ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">âš¡</span>
            ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ í…ŒìŠ¤íŠ¸
          </div>
          <div class="input-group">
            <input
              type="number"
              id="benchmark-requests"
              placeholder="ìš”ì²­ ìˆ˜"
              value="5"
              min="1"
              max="50"
            />
            <input
              type="number"
              id="benchmark-concurrent"
              placeholder="ë™ì‹œ ìš”ì²­"
              value="2"
              min="1"
              max="10"
            />
          </div>
          <div class="button-group">
            <button class="btn" onclick="benchmarkSearch()">
              ğŸ” ê²€ìƒ‰ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
            </button>
            <button class="btn" onclick="benchmarkAI()">ğŸ¤– AI ê²€ìƒ‰ ì„±ëŠ¥</button>
            <button class="btn" onclick="benchmarkCache()">
              ğŸ’¾ ìºì‹œ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
            </button>
            <button class="btn" onclick="fullSystemBenchmark()">
              ğŸ† ì¢…í•© ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
            </button>
          </div>
          <div id="benchmark-result" class="result-area">
            ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>

        <!-- ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">ğŸš¨</span>
            ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
          </div>
          <div class="button-group">
            <button class="btn" onclick="testInvalidRequests()">
              âŒ ì˜ëª»ëœ ìš”ì²­ í…ŒìŠ¤íŠ¸
            </button>
            <button class="btn" onclick="testApiLimits()">
              ğŸš« API í•œë„ í…ŒìŠ¤íŠ¸
            </button>
            <button class="btn" onclick="testNetworkErrors()">
              ğŸŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œë®¬ë ˆì´ì…˜
            </button>
            <button class="btn" onclick="testEdgeCases()">
              ğŸ”„ ì—£ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸
            </button>
          </div>
          <div id="error-result" class="result-area">
            ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>

        <!-- AI ìì—°ì–´ ê²€ìƒ‰ -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">ğŸ¤–</span>
            AI ìì—°ì–´ ê²€ìƒ‰ (MCP í†µí•©)
          </div>
          <div class="input-group">
            <textarea
              id="ai-message"
              placeholder="ì˜ˆ: ì˜¤ëŠ˜ í”¼ê³¤í•œë° íë§ë˜ëŠ” ì˜ìƒ ë³´ì—¬ì¤˜"
              style="height: 80px; resize: vertical"
            >
ì˜¤ëŠ˜ í”¼ê³¤í•œë° íë§ë˜ëŠ” ì˜ìƒ ë³´ì—¬ì¤˜</textarea
            >
          </div>
          <div class="button-group">
            <button class="btn" onclick="testAISearch(true)">
              ğŸ§  AI ë¶„ì„ (Claude)
            </button>
            <button class="btn" onclick="testAISearch(false)">
              âš¡ íŒ¨í„´ ë§¤ì¹­
            </button>
            <button class="btn small" onclick="setAIExample('í”¼ê³¤')">
              í”¼ê³¤í•  ë•Œ
            </button>
            <button class="btn small" onclick="setAIExample('ì ì‹¬')">
              ì ì‹¬ì‹œê°„
            </button>
            <button class="btn small" onclick="setAIExample('ìš´ë™')">
              ìš´ë™í•˜ê³ ì‹¶ì–´
            </button>
          </div>
          <div id="ai-search-result" class="result-area">
            AI ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>

        <!-- íŠ¸ë Œë”© í‚¤ì›Œë“œ -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">ğŸ”¥</span>
            ì‹¤ì‹œê°„ íŠ¸ë Œë”© í‚¤ì›Œë“œ (SerpAPI + n8n)
          </div>
          <div class="button-group">
            <button class="btn" onclick="getTrendingKeywords('all')">
              ê¸°ë³¸ íŠ¸ë Œë“œ
            </button>
            <button class="btn" onclick="getRealtimeTrends('KR')">
              ğŸ”¥ ì‹¤ì‹œê°„ íŠ¸ë Œë“œ
            </button>
            <button class="btn" onclick="getTrendStats()">
              ğŸ“Š íŠ¸ë Œë“œ í†µê³„
            </button>
            <button class="btn small" onclick="getTrendingKeywords('comedy')">
              ì½”ë¯¸ë””
            </button>
            <button class="btn small" onclick="getTrendingKeywords('music')">
              ìŒì•…
            </button>
            <button class="btn small" onclick="getTrendingKeywords('gaming')">
              ê²Œì´ë°
            </button>
            <button class="btn small" onclick="getTrendingKeywords('food')">
              ìŒì‹
            </button>
            <button class="btn small" onclick="getTimeBasedTrends()">
              â° ì‹œê°„ëŒ€ë³„
            </button>
          </div>
          <div id="realtime-trending-result" class="result-area">
            íŠ¸ë Œë”© í‚¤ì›Œë“œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>

        <!-- ê°œì¸í™” ì¶”ì²œ -->
        <div class="api-section">
          <div class="api-title">
            <span class="emoji">â­</span>
            ê°œì¸í™” ì¶”ì²œ (í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥)
          </div>
          <div class="input-group">
            <input
              type="text"
              id="pref-categories"
              placeholder="ì„ í˜¸ ì¹´í…Œê³ ë¦¬ (ì‰¼í‘œë¡œ êµ¬ë¶„)"
              value="comedy, music"
            />
          </div>
          <div class="button-group">
            <button class="btn" onclick="testPersonalized()">
              ê°œì¸í™” ì¶”ì²œ ë°›ê¸°
            </button>
          </div>
          <div id="personalized-result" class="result-area">
            ê°œì¸í™” ì¶”ì²œ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
          </div>
        </div>
      </div>

      <div class="footer">
        <p>ğŸŒŠ Wave Team | âš¡ Momentum Project | ë°±ì—”ë“œ API í…ŒìŠ¤íŠ¸ í˜ì´ì§€</p>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:3002";

      // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
      function showLoading(elementId) {
        document.getElementById(elementId).innerHTML =
          '<span class="loading">â³ ë¡œë”© ì¤‘...</span>';
      }

      function showResult(elementId, data, isError = false) {
        const element = document.getElementById(elementId);
        element.innerHTML = JSON.stringify(data, null, 2);
        element.className = `result-area ${isError ? "error" : "success"}`;

        // Clear ë²„íŠ¼ ì¶”ê°€ (ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ ë” ì •í™•íˆ í™•ì¸)
        const parentElement = element.parentNode;
        let existingClearBtn = parentElement.querySelector(".clear-btn");

        if (!existingClearBtn) {
          const clearBtn = document.createElement("button");
          clearBtn.textContent = "ì§€ìš°ê¸°";
          clearBtn.className = "btn clear-btn";
          clearBtn.onclick = () => {
            element.innerHTML = "ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...";
            element.className = "result-area";
            // ì§€ìš°ê¸° ë²„íŠ¼ë„ í•¨ê»˜ ì œê±°
            clearBtn.remove();
          };
          parentElement.insertBefore(clearBtn, element);
        }
      }

      async function makeApiCall(url, options = {}) {
        try {
          const response = await fetch(url, {
            ...options,
            headers: {
              "Content-Type": "application/json",
              ...options.headers,
            },
          });

          const data = await response.json();
          return { data, status: response.status, ok: response.ok };
        } catch (error) {
          return {
            data: { error: "Network Error", message: error.message },
            status: 0,
            ok: false,
          };
        }
      }

      // ì„œë²„ ìƒíƒœ í™•ì¸ í•¨ìˆ˜ë“¤
      async function checkServerHealth() {
        showLoading("status-result");
        const result = await makeApiCall(`${API_BASE}/health`);
        showResult("status-result", result.data, !result.ok);
      }

      async function checkApiInfo() {
        showLoading("status-result");
        const result = await makeApiCall(`${API_BASE}/api/v1`);
        showResult("status-result", result.data, !result.ok);
      }

      async function checkYouTubeStatus() {
        showLoading("status-result");
        const result = await makeApiCall(`${API_BASE}/api/v1/videos/status`);
        showResult("status-result", result.data, !result.ok);
      }

      // Shorts ê²€ìƒ‰ í•¨ìˆ˜ë“¤
      async function searchShorts() {
        const query = document.getElementById("search-query").value.trim();
        const maxResults = document.getElementById("search-max").value;
        const order = document.getElementById("search-order").value;

        if (!query) {
          showResult(
            "search-result",
            { error: "ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!" },
            true
          );
          return;
        }

        showLoading("search-result");
        const url = `${API_BASE}/api/v1/videos/search?q=${encodeURIComponent(
          query
        )}&maxResults=${maxResults}&order=${order}`;
        const result = await makeApiCall(url);
        showResult("search-result", result.data, !result.ok);
      }

      async function searchPreset(query) {
        document.getElementById("search-query").value = query;
        await searchShorts();
      }

      // ì¸ê¸° Shorts í•¨ìˆ˜
      async function getTrendingShorts() {
        const maxResults = document.getElementById("trending-max").value;
        const regionCode = document.getElementById("trending-region").value;

        showLoading("trending-result");
        const url = `${API_BASE}/api/v1/videos/trending?maxResults=${maxResults}&regionCode=${regionCode}`;
        const result = await makeApiCall(url);
        showResult("trending-result", result.data, !result.ok);
      }

      // ì¹´í…Œê³ ë¦¬ë³„ ê²€ìƒ‰ í•¨ìˆ˜
      async function getByCategory(category) {
        const maxResults = document.getElementById("category-max").value;

        showLoading("category-result");
        const url = `${API_BASE}/api/v1/videos/categories/${category}?maxResults=${maxResults}`;
        const result = await makeApiCall(url);
        showResult("category-result", result.data, !result.ok);
      }

      // ìºì‹œ ì •ë¦¬ í•¨ìˆ˜
      async function clearCache() {
        showLoading("cache-result");
        const result = await makeApiCall(
          `${API_BASE}/api/v1/videos/cache/clear`,
          {
            method: "POST",
          }
        );
        showResult("cache-result", result.data, !result.ok);
      }

      // AI ìì—°ì–´ ê²€ìƒ‰
      async function testAISearch(useAI) {
        const message = document.getElementById("ai-message").value.trim();
        if (!message) {
          showResult(
            "ai-search-result",
            { error: "ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!" },
            true
          );
          return;
        }

        showLoading("ai-search-result");
        const url = `${API_BASE}/api/v1/videos/ai-search`;
        const result = await makeApiCall(url, {
          method: "POST",
          body: JSON.stringify({ message, useAI }),
        });

        if (result.ok && result.data.success) {
          // ê²°ê³¼ë¥¼ ë³´ê¸° ì¢‹ê²Œ í¬ë§·íŒ…
          const data = result.data.data;
          let formatted = `ğŸ¯ ì¶”ì¶œëœ í‚¤ì›Œë“œ: ${data.extraction.keywords.join(
            ", "
          )}\n`;
          formatted += `ğŸ“Š ë¶„ì„ ë°©ë²•: ${data.extraction.method}\n`;
          formatted += `ğŸ’¬ AI ì‘ë‹µ: ${data.response.message}\n\n`;

          if (data.response.suggestions?.length > 0) {
            formatted += `ğŸ’¡ ì¶”ì²œ í‚¤ì›Œë“œ: ${data.response.suggestions.join(
              ", "
            )}\n\n`;
          }

          formatted += `ğŸ¬ ê²€ìƒ‰ëœ ì˜ìƒ: ${data.videos.length}ê°œ\n`;
          data.videos.slice(0, 3).forEach((video, i) => {
            formatted += `\n${i + 1}. ${video.title}\n`;
            formatted += `   ğŸ“º ${video.channel}\n`;
            formatted += `   ğŸ‘€ ì¡°íšŒìˆ˜: ${
              video.viewCount?.toLocaleString() || "N/A"
            }\n`;
          });

          showResult("ai-search-result", formatted);
        } else {
          showResult("ai-search-result", result.data, true);
        }
      }

      // AI ì˜ˆì œ ì„¤ì •
      function setAIExample(type) {
        const examples = {
          í”¼ê³¤: "ì˜¤ëŠ˜ ë„ˆë¬´ í”¼ê³¤í•œë° íë§ë˜ëŠ” ì˜ìƒ ë³´ì—¬ì¤˜",
          ì ì‹¬: "ì ì‹¬ì‹œê°„ì— ë³¼ë§Œí•œ ì§§ê³  ì¬ë¯¸ìˆëŠ” ì˜ìƒ ì¶”ì²œí•´ì¤˜",
          ìš´ë™: "ìš´ë™ ë™ê¸°ë¶€ì—¬ë˜ëŠ” ì˜ìƒì´ë‚˜ í™ˆíŠ¸ë ˆì´ë‹ ì˜ìƒ ë³´ê³ ì‹¶ì–´",
        };
        document.getElementById("ai-message").value = examples[type] || "";
      }

      // íŠ¸ë Œë”© í‚¤ì›Œë“œ
      async function getTrendingKeywords(category) {
        showLoading("realtime-trending-result");
        const url = `${API_BASE}/api/v1/videos/trending-keywords?category=${category}`;
        const result = await makeApiCall(url);

        if (result.ok && result.data.success) {
          const data = result.data.data;
          let formatted = `ğŸ“Š ì¹´í…Œê³ ë¦¬: ${data.category}\n`;
          formatted += `ğŸ”¥ íŠ¸ë Œë”©: ${data.trending.join(", ")}\n`;

          if (data.timeRecommended?.length > 0) {
            formatted += `â° ì‹œê°„ëŒ€ ì¶”ì²œ (${
              data.currentTime.timeOfDay
            }): ${data.timeRecommended.join(", ")}\n`;
          }

          formatted += `\nğŸ“… ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${data.lastUpdated}`;
          showResult("realtime-trending-result", formatted);
        } else {
          showResult("realtime-trending-result", result.data, true);
        }
      }

      // ğŸ”¥ NEW: ì‹¤ì‹œê°„ íŠ¸ë Œë“œ (SerpAPI + n8n)
      async function getRealtimeTrends(region = "KR", forceRefresh = false) {
        showLoading("realtime-trending-result");
        const refreshParam = forceRefresh ? "&refresh=true" : "";
        const url = `${API_BASE}/api/v1/trends/realtime?region=${region}${refreshParam}`;
        const result = await makeApiCall(url);

        // ğŸ› ë””ë²„ê·¸: ì‹¤ì œ ì‘ë‹µ êµ¬ì¡° í™•ì¸
        console.log("ğŸ” API ì‘ë‹µ ì „ì²´:", result);
        console.log("ğŸ“Š ì‘ë‹µ ë°ì´í„°:", result.data);

        if (result.ok && result.data.success) {
          const data = result.data.data;
          const analysis = data.analysis || {};
          const sourceBreakdown = data.sourceBreakdown || {};

          // ğŸ› ë””ë²„ê·¸: íŠ¸ë Œë“œ ë°ì´í„° êµ¬ì¡° í™•ì¸
          console.log("ğŸ¯ íŠ¸ë Œë“œ ë°ì´í„°:", data);
          console.log("ğŸ“ˆ ë¶„ì„ ë°ì´í„°:", analysis);
          console.log("ğŸ“‹ ì†ŒìŠ¤ë³„ ë°ì´í„°:", sourceBreakdown);

          let formatted = `ğŸ”¥ ì‹¤ì‹œê°„ íŠ¸ë Œë“œ (${
            data.region
          }) - ì†ŒìŠ¤: ${data.sources.join(", ")}\n\n`;

          // ğŸ“Š ë°ì´í„° ì†ŒìŠ¤ë³„ í’ˆì§ˆ ë¶„ì„ í‘œì‹œ (ì•ˆì „í•œ ì ‘ê·¼)
          if (analysis.bySource && Object.keys(analysis.bySource).length > 0) {
            formatted += `ğŸ“Š ë°ì´í„° ì†ŒìŠ¤ í’ˆì§ˆ ë¶„ì„\n`;
            formatted += `${"=".repeat(50)}\n`;

            Object.entries(analysis.bySource).forEach(
              ([source, sourceAnalysis]) => {
                const qualityEmoji = getQualityEmoji(sourceAnalysis.quality);
                formatted += `\nğŸ”¸ ${getSourceDisplayName(
                  source
                )} ${qualityEmoji}\n`;
                formatted += `   â€¢ ë°ì´í„° ìˆ˜: ${sourceAnalysis.count}ê°œ\n`;
                formatted += `   â€¢ í’ˆì§ˆ: ${
                  sourceAnalysis.quality
                } (${sourceAnalysis.avgScore?.toFixed(1)}ì )\n`;
                formatted += `   â€¢ í•œêµ­ì–´ ë¹„ìœ¨: ${sourceAnalysis.koreanRatio}%\n`;
                formatted += `   â€¢ ê³ ìœ  í‚¤ì›Œë“œ: ${sourceAnalysis.uniqueKeywords}ê°œ\n`;

                if (sourceAnalysis.searchVolumeAvg > 0) {
                  formatted += `   â€¢ í‰ê·  ê²€ìƒ‰ëŸ‰: ${sourceAnalysis.searchVolumeAvg.toLocaleString()}\n`;
                }

                if (sourceAnalysis.issues && sourceAnalysis.issues.length > 0) {
                  formatted += `   â€¢ ë¬¸ì œì : ${sourceAnalysis.issues.join(
                    ", "
                  )}\n`;
                }

                // ì¹´í…Œê³ ë¦¬ ë¶„í¬ (ìƒìœ„ 3ê°œë§Œ)
                const topCategories = Object.entries(
                  sourceAnalysis.categoryDistribution || {}
                )
                  .sort(([, a], [, b]) => b - a)
                  .slice(0, 3)
                  .map(([cat, count]) => `${cat}(${count})`)
                  .join(", ");
                if (topCategories) {
                  formatted += `   â€¢ ì£¼ìš” ì¹´í…Œê³ ë¦¬: ${topCategories}\n`;
                }
              }
            );
          } else {
            formatted += `âš ï¸ í’ˆì§ˆ ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ë¥¼ ì¬ì‹œì‘í•´ì£¼ì„¸ìš”.\n\n`;
          }

          // ğŸ¯ ì¶”ì²œì‚¬í•­ í‘œì‹œ (ì•ˆì „í•œ ì ‘ê·¼)
          if (analysis.recommendations && analysis.recommendations.length > 0) {
            formatted += `\n\nğŸ’¡ ì¶”ì²œì‚¬í•­\n`;
            formatted += `${"=".repeat(50)}\n`;
            analysis.recommendations.forEach((rec, index) => {
              const emoji = getRecommendationEmoji(rec.type);
              formatted += `${emoji} ${rec.message}\n`;
              formatted += `   â†’ ${rec.reason}\n\n`;
            });
          }

          // ğŸ“ˆ ì „ì²´ í†µê³„ (ì•ˆì „í•œ ì ‘ê·¼)
          if (analysis.overall) {
            formatted += `ğŸ“ˆ ì „ì²´ í†µê³„\n`;
            formatted += `${"=".repeat(50)}\n`;
            formatted += `â€¢ ì´ íŠ¸ë Œë“œ: ${analysis.overall.totalTrends}ê°œ\n`;
            formatted += `â€¢ í•œêµ­ì–´ í‚¤ì›Œë“œ: ${
              analysis.overall.koreanKeywords
            }ê°œ (${Math.round(
              (analysis.overall.koreanKeywords / analysis.overall.totalTrends) *
                100
            )}%)\n`;
            formatted += `â€¢ í‰ê·  ì ìˆ˜: ${analysis.overall.avgScore}ì \n`;
            formatted += `â€¢ í™œì„± ì†ŒìŠ¤: ${analysis.overall.uniqueSources}ê°œ\n\n`;
          }

          // ğŸ† ìƒìœ„ íŠ¸ë Œë“œ í‚¤ì›Œë“œ (Top 10ë§Œ)
          formatted += `ğŸ† ìƒìœ„ íŠ¸ë Œë“œ í‚¤ì›Œë“œ (Top 10)\n`;
          formatted += `${"=".repeat(50)}\n`;

          if (data.trends && data.trends.length > 0) {
            data.trends.slice(0, 10).forEach((trend, i) => {
              const sourceEmoji = getSourceEmoji(trend.source);
              formatted += `${i + 1}. ${trend.keyword} (${
                trend.category
              }) ${sourceEmoji}\n`;
              formatted += `   ğŸ“Š ì ìˆ˜: ${trend.score} | ğŸ”— ì†ŒìŠ¤: ${trend.source}\n`;

              if (trend.searchVolume > 0) {
                formatted += `   ğŸ‘€ ê²€ìƒ‰ëŸ‰: ${trend.searchVolume.toLocaleString()}\n`;
              }
              if (trend.views > 0) {
                formatted += `   ğŸ‘ï¸ ì¡°íšŒìˆ˜: ${trend.views.toLocaleString()}\n`;
              }
              if (trend.originalTitle) {
                formatted += `   ğŸ“º ì›ì œ: ${trend.originalTitle.substring(
                  0,
                  40
                )}...\n`;
              }
              formatted += "\n";
            });
          } else {
            formatted += "âŒ íŠ¸ë Œë“œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\n\n";
          }

          // ğŸ“‹ ê° ì†ŒìŠ¤ë³„ ì›ë³¸ ë°ì´í„° (ê°„ëµíˆ) - ì•ˆì „í•œ ì ‘ê·¼
          if (Object.keys(sourceBreakdown).length > 0) {
            formatted += `\nğŸ“‹ ì†ŒìŠ¤ë³„ ìƒì„¸ ë°ì´í„°\n`;
            formatted += `${"=".repeat(50)}\n`;

            Object.entries(sourceBreakdown).forEach(([source, sourceData]) => {
              if (sourceData && sourceData.length > 0) {
                formatted += `\nğŸ”¸ ${getSourceDisplayName(source)} (${
                  sourceData.length
                }ê°œ)\n`;
                sourceData.slice(0, 3).forEach((item, i) => {
                  formatted += `   ${i + 1}. ${item.keyword} (ì ìˆ˜: ${
                    item.score
                  })\n`;
                });
                if (sourceData.length > 3) {
                  formatted += `   ... ì™¸ ${sourceData.length - 3}ê°œ\n`;
                }
              }
            });
          }

          formatted += `\nğŸ“Š ì´ ${data.total}ê°œ í‚¤ì›Œë“œ`;
          formatted += `\nğŸ“… ì—…ë°ì´íŠ¸: ${new Date(
            data.timestamp
          ).toLocaleString()}`;
          formatted += `\nğŸ’¾ ìºì‹œ ì‚¬ìš©: ${data.cached ? "Yes" : "No"}`;

          if (result.data.meta) {
            formatted += `\nğŸ”§ ë°ì´í„° ì†ŒìŠ¤: ${result.data.meta.dataSources.join(
              ", "
            )}`;
            formatted += `\nâ±ï¸ ì—…ë°ì´íŠ¸ ì£¼ê¸°: ${result.data.meta.updateInterval}`;
          }

          // ğŸ”§ ì§ì ‘ DOM ì¡°ì‘ìœ¼ë¡œ ë¬¸ì œ í•´ê²° ì‹œë„
          const resultElement = document.getElementById(
            "realtime-trending-result"
          );
          console.log("ğŸ¯ realtime-trending-result ìš”ì†Œ:", resultElement);

          if (resultElement) {
            resultElement.innerHTML = formatted.replace(/\n/g, "<br>");
            resultElement.className = "result-area success";
            console.log("âœ… ì§ì ‘ DOM ì„¤ì • ì™„ë£Œ");
          } else {
            console.error("âŒ realtime-trending-result ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ");
          }

          // ê¸°ì¡´ showResultë„ í˜¸ì¶œ (ë¹„êµìš©)
          showResult("realtime-trending-result", formatted);
        } else {
          // ğŸ› ë””ë²„ê·¸: ì‹¤íŒ¨ ì¼€ì´ìŠ¤ë„ ìƒì„¸íˆ í‘œì‹œ
          console.log("âŒ API í˜¸ì¶œ ì‹¤íŒ¨:", result);

          let errorFormatted = `âŒ API í˜¸ì¶œ ì‹¤íŒ¨\n\n`;
          errorFormatted += `HTTP ìƒíƒœ: ${result.status}\n`;
          errorFormatted += `ì‘ë‹µ ì„±ê³µ: ${result.ok}\n`;
          errorFormatted += `ë°ì´í„°: ${JSON.stringify(result.data, null, 2)}`;

          showResult("realtime-trending-result", errorFormatted, true);
        }
      }

      // í—¬í¼ í•¨ìˆ˜ë“¤ (ì „ì—­ ìŠ¤ì½”í”„)
      function getQualityEmoji(quality) {
        const emojis = {
          excellent: "ğŸŒŸ",
          good: "âœ…",
          fair: "âš ï¸",
          poor: "âŒ",
          very_poor: "ğŸ’¥",
        };
        return emojis[quality] || "â“";
      }

      function getSourceDisplayName(source) {
        const names = {
          googleTrends: "Google Trends",
          youtubeTrends: "YouTube íŠ¸ë Œë”©",
          youtubeShorts: "YouTube Shorts",
        };
        return names[source] || source;
      }

      function getSourceEmoji(source) {
        const emojis = {
          google_trends: "ğŸ”",
          youtube_trending: "ğŸ“º",
          youtube_shorts: "ğŸ¬",
        };
        return emojis[source] || "ğŸ“Š";
      }

      function getRecommendationEmoji(type) {
        const emojis = {
          primary_source: "ğŸ¯",
          multi_source: "ğŸ”—",
          single_source: "â­",
          improvement: "ğŸ”§",
        };
        return emojis[type] || "ğŸ’¡";
      }

      // ğŸ“Š íŠ¸ë Œë“œ ì„œë¹„ìŠ¤ í†µê³„
      async function getTrendStats() {
        showLoading("realtime-trending-result");
        const result = await makeApiCall(`${API_BASE}/api/v1/trends/stats`);

        if (result.ok && result.data.success) {
          const stats = result.data.data;
          let formatted = `ğŸ“Š íŠ¸ë Œë“œ ì„œë¹„ìŠ¤ í†µê³„\n\n`;
          formatted += `ğŸ’¾ ìºì‹œ í¬ê¸°: ${stats.cacheSize}ê°œ í•­ëª©\n`;
          formatted += `\nğŸ”Œ ì‚¬ìš© ê°€ëŠ¥í•œ API:\n`;
          formatted += `  - SerpAPI: ${
            stats.availableApis.serpapi ? "âœ… ì—°ê²°ë¨" : "âŒ ë¯¸ì—°ê²°"
          }\n`;
          formatted += `  - n8n ì›Œí¬í”Œë¡œìš°: ${
            stats.availableApis.n8n ? "âœ… ì—°ê²°ë¨" : "âŒ ë¯¸ì—°ê²°"
          }\n`;
          formatted += `  - YouTube API: ${
            stats.availableApis.youtube ? "âœ… ì—°ê²°ë¨" : "âŒ ë¯¸ì—°ê²°"
          }\n`;
          formatted += `\nğŸ“… ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date(
            stats.lastUpdate
          ).toLocaleString()}`;

          showResult("realtime-trending-result", formatted);
        } else {
          showResult("realtime-trending-result", result.data, true);
        }
      }

      // â° ì‹œê°„ëŒ€ë³„ íŠ¸ë Œë“œ ì¶”ì²œ
      async function getTimeBasedTrends() {
        showLoading("realtime-trending-result");
        const result = await makeApiCall(
          `${API_BASE}/api/v1/trends/time-based`
        );

        if (result.ok && result.data.success) {
          const data = result.data.data;
          let formatted = `â° ì‹œê°„ëŒ€ë³„ ì¶”ì²œ í‚¤ì›Œë“œ\n\n`;
          formatted += `ğŸ• í˜„ì¬ ì‹œê°„: ${data.currentHour}ì‹œ (${data.timeCategory})\n`;
          formatted += `ğŸ“ ì„¤ëª…: ${data.description}\n\n`;
          formatted += `âœ¨ ì¶”ì²œ í‚¤ì›Œë“œ:\n`;
          data.keywords.forEach((keyword, i) => {
            formatted += `  ${i + 1}. ${keyword}\n`;
          });

          showResult("realtime-trending-result", formatted);
        } else {
          showResult("realtime-trending-result", result.data, true);
        }
      }

      // ê°œì¸í™” ì¶”ì²œ
      async function testPersonalized() {
        const categories = document
          .getElementById("pref-categories")
          .value.split(",")
          .map((c) => c.trim())
          .filter((c) => c);

        showLoading("personalized-result");
        const url = `${API_BASE}/api/v1/videos/personalized`;
        const result = await makeApiCall(url, {
          method: "POST",
          body: JSON.stringify({
            userId: "test-user-123",
            preferences: { categories },
            recentViews: [],
          }),
        });

        if (result.ok && result.data.success) {
          const data = result.data.data;
          let formatted = `ğŸ¯ ì¶”ì²œ í‚¤ì›Œë“œ: ${data.recommendedKeywords.join(
            ", "
          )}\n`;
          formatted += `ğŸ“Š ê°œì¸í™” ìˆ˜ì¤€: ${data.personalizationLevel}\n`;
          formatted += `â° í˜„ì¬ ì‹œê°„ëŒ€: ${data.context.timeOfDay}\n\n`;
          formatted += `ğŸ¬ ì¶”ì²œ ì˜ìƒ: ${data.videos.length}ê°œ\n`;

          data.videos.slice(0, 3).forEach((video, i) => {
            formatted += `\n${i + 1}. ${video.title}\n`;
            formatted += `   ğŸ“º ${video.channel}\n`;
          });

          showResult("personalized-result", formatted);
        } else {
          showResult("personalized-result", result.data, true);
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ ìƒíƒœ í™•ì¸
      window.onload = function () {
        checkServerHealth();
      };
    </script>
  </body>
</html>
