# 11. ë°°í¬ ë° DevOps ìš”ì•½

> ìƒì„¸ ë¬¸ì„œ: [docs/basic/11.ë°°í¬ ë° DevOps.md](../basic/11.ë°°í¬%20ë°%20DevOps.md)

## ğŸ¯ í•µì‹¬ DevOps ì§€í‘œ

### ì‹ ë¢°ì„± ëª©í‘œ

- **ê°€ìš©ì„±**: 99.9% (ì—°ê°„ 8.7ì‹œê°„ ë‹¤ìš´íƒ€ì„)
- **RTO (ë³µêµ¬ ì‹œê°„)**: 4ì‹œê°„ ì´ë‚´
- **RPO (ë°ì´í„° ì†ì‹¤)**: 1ì‹œê°„ ì´ë‚´
- **ë°°í¬ ì„±ê³µë¥ **: 95% ì´ìƒ

### ì„±ëŠ¥ ì§€í‘œ

- **ë°°í¬ ì£¼ê¸°**: ì£¼ 2-3íšŒ
- **ë¡¤ë°± ì‹œê°„**: 5ë¶„ ì´ë‚´
- **ëª¨ë‹ˆí„°ë§ ì‘ë‹µ**: 30ì´ˆ ì´ë‚´
- **ë°±ì—… ì£¼ê¸°**: ì¼ 1íšŒ, ì£¼ 1íšŒ, ì›” 1íšŒ

## ğŸš€ Railway ë°°í¬ í”Œë«í¼

### ë©€í‹° ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜

```yaml
# railway.yml - ì„œë¹„ìŠ¤ ì •ì˜
services:
  backend: # Express.js API ì„œë²„
    buildCommand: "npm ci && npm run build"
    startCommand: "npm run start"
    healthcheckPath: "/api/health"
    numReplicas: 2

  frontend: # ì •ì  íŒŒì¼ ì„œë²„ (Webpack ë²ˆë“¤)
    buildCommand: "npm ci && npm run build"
    startCommand: "npx serve -s dist -l $PORT"
    numReplicas: 1

  worker: # ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… (íŠ¸ë Œë“œ ìˆ˜ì§‘, ìºì‹œ ì›Œë°)
    startCommand: "npm run worker"
    numReplicas: 1

  redis: # ìºì‹± ë ˆì´ì–´
    image: "redis:7-alpine"
    command: "redis-server --appendonly yes"
```

### í™˜ê²½ë³€ìˆ˜ ì•”í˜¸í™” ê´€ë¦¬

```javascript
// scripts/setup-railway-env.js
class RailwayEnvManager {
  // AES-256-GCM ì•”í˜¸í™”ë¡œ ì‹œí¬ë¦¿ ë³´í˜¸
  encryptSecret(secret) {
    const iv = crypto.randomBytes(16);
    const cipher = crypto.createCipheriv("aes-256-gcm", masterKey, iv);
    // ì•”í˜¸í™” ë¡œì§
  }

  // í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜ ê²€ì¦ ë° ì„¤ì •
  async setEnvironmentVariables() {
    const requiredVars = [
      "SUPABASE_URL",
      "SUPABASE_SERVICE_ROLE_KEY",
      "YOUTUBE_API_KEY",
      "CLAUDE_API_KEY",
      "JWT_SECRET",
      "ENCRYPTION_KEY",
    ];
    // Railway CLIë¡œ í™˜ê²½ë³€ìˆ˜ ì„¤ì •
  }
}
```

## ğŸ”„ CI/CD íŒŒì´í”„ë¼ì¸

### GitHub Actions ì›Œí¬í”Œë¡œìš°

```yaml
# .github/workflows/deploy.yml
name: Deploy to Railway

on:
  push:
    branches: [main, staging]

jobs:
  test:
    steps:
      - npm ci
      - npm test # ìœ ë‹› í…ŒìŠ¤íŠ¸
      - npm audit # ë³´ì•ˆ ì·¨ì•½ì  ìŠ¤ìº”
      - npm run lint # ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬

  deploy-staging:
    if: github.ref == 'refs/heads/staging'
    steps:
      - railway up --detach
      - npm run test:smoke:staging # ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸

  deploy-production:
    if: github.ref == 'refs/heads/main'
    steps:
      - railway up --detach
      - health check ëŒ€ê¸° 60ì´ˆ
      - npm run test:e2e:production
```

### ë°°í¬ ê²€ì¦ ë‹¨ê³„

1. **ìœ ë‹› í…ŒìŠ¤íŠ¸**: Jest ê¸°ë°˜ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
2. **í†µí•© í…ŒìŠ¤íŠ¸**: API ì—”ë“œí¬ì¸íŠ¸ ê²€ì¦
3. **ë³´ì•ˆ ìŠ¤ìº”**: npm audit, Snyk ì·¨ì•½ì  ë¶„ì„
4. **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**: Lighthouse CI ì ìˆ˜ í™•ì¸
5. **ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸**: í•µì‹¬ ê¸°ëŠ¥ ë™ì‘ í™•ì¸

## ğŸ“Š í¬ê´„ì  ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

### 3ê³„ì¸µ ë¡œê¹… êµ¬ì¡°

```javascript
// config/logging.js - Winston ê¸°ë°˜
const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || "info",
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: "error.log", level: "error" }),
    new winston.transports.File({ filename: "combined.log" }),
    new winston.transports.Console({ format: winston.format.simple() }),
  ],
});

// ë¡œê·¸ ë ˆë²¨ë³„ ì²˜ë¦¬
// ERROR: ì¦‰ì‹œ ì•Œë¦¼ + Sentry ì „ì†¡
// WARN: ì§‘ê³„ í›„ ì¼ì¼ ë¦¬í¬íŠ¸
// INFO: ì‹œìŠ¤í…œ ìƒíƒœ ë¡œê¹…
// DEBUG: ê°œë°œ í™˜ê²½ ìƒì„¸ ì¶”ì 
```

### OpenTelemetry ë¶„ì‚° ì¶”ì 

```javascript
// config/tracing.js
class TracingService {
  initialize() {
    const tracer = NodeSDK({
      resource: new Resource({
        [SemanticResourceAttributes.SERVICE_NAME]: "youtube-shorts-curator",
        [SemanticResourceAttributes.SERVICE_VERSION]: process.env.APP_VERSION,
      }),
      instrumentations: [
        new HttpInstrumentation(),
        new ExpressInstrumentation(),
        new RedisInstrumentation(),
      ],
    });
  }

  // ì»¤ìŠ¤í…€ ìŠ¤íŒ¬ ìƒì„±
  createSpan(name, operation) {
    return tracer.startSpan(name, {
      kind: SpanKind.INTERNAL,
      attributes: { operation },
    });
  }
}
```

### Sentry ì—ëŸ¬ ì¶”ì 

```javascript
// monitoring/errorTracking.js
class ErrorTrackingService {
  initialize(app) {
    Sentry.init({
      dsn: process.env.SENTRY_DSN,
      integrations: [
        new Sentry.Integrations.Http({ tracing: true }),
        new Sentry.Integrations.Express({ app }),
      ],
      tracesSampleRate: 0.1, // 10% ìƒ˜í”Œë§
      beforeSend(event) {
        // PII ë°ì´í„° ì œê±°
        return this.sanitizeEvent(event);
      },
    });
  }

  // ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ì—ëŸ¬ ë³´ê³ 
  captureException(error, context) {
    Sentry.captureException(error, {
      tags: { component: context.component, action: context.action },
      extra: context,
    });
  }
}
```

## ğŸ”” ë‹¤ì¤‘ ì±„ë„ ì•Œë¦¼ ì‹œìŠ¤í…œ

### ìš°ì„ ìˆœìœ„ë³„ ì•Œë¦¼ ì „ëµ

```javascript
// monitoring/alerting.js
class AlertingService {
  constructor() {
    this.alertChain = [
      {
        level: 1, // CRITICAL
        delay: 0,
        channels: ["slack", "email", "sms"],
        contacts: ["oncall@company.com"],
      },
      {
        level: 2, // HIGH
        delay: "15min",
        channels: ["slack", "email"],
        contacts: ["team-lead@company.com"],
      },
      {
        level: 3, // MEDIUM
        delay: "30min",
        channels: ["slack"],
        contacts: ["dev-team@company.com"],
      },
    ];
  }

  // ì•Œë¦¼ ê·œì¹™ ì •ì˜
  alertRules = {
    system: {
      high_cpu: { threshold: 80, priority: "high" },
      high_memory: { threshold: 90, priority: "high" },
      disk_space: { threshold: 85, priority: "medium" },
    },
    api: {
      high_error_rate: { threshold: 5, priority: "high" },
      slow_response: { threshold: 2000, priority: "medium" },
      rate_limit_exceeded: { threshold: 1000, priority: "medium" },
    },
    business: {
      youtube_quota_usage: { threshold: 80, priority: "high" },
      low_cache_hit_rate: { threshold: 60, priority: "medium" },
      payment_failure: { threshold: 5, priority: "critical" },
    },
  };
}
```

### í†µí•© ì•Œë¦¼ ì±„ë„

- **Slack**: ì‹¤ì‹œê°„ íŒ€ ì•Œë¦¼, ë´‡ ìƒí˜¸ì‘ìš©
- **Email**: ìƒì„¸ ë³´ê³ ì„œ, ê´€ë¦¬ì ì•Œë¦¼
- **SMS**: ê¸´ê¸‰ ì•Œë¦¼ (Twilio)
- **PagerDuty**: 24/7 ì˜¨ì½œ ì‹œìŠ¤í…œ

## ğŸ’¾ ìë™ ë°±ì—… ì‹œìŠ¤í…œ

### 3ë‹¨ê³„ ë°±ì—… ì „ëµ

```javascript
// backup/databaseBackup.js
class DatabaseBackupService {
  async performBackup(type = "scheduled") {
    // 1. PostgreSQL ë¤í”„ ìƒì„±
    const dumpFile = await this.dumpDatabase(backupId);

    // 2. ì••ì¶• ë° AES-256 ì•”í˜¸í™”
    const encryptedFile = await this.compressAndEncrypt(dumpFile);

    // 3. S3 ì—…ë¡œë“œ (STANDARD_IA ìŠ¤í† ë¦¬ì§€)
    const s3Location = await this.uploadToS3(encryptedFile, backupId);

    // 4. ë©”íƒ€ë°ì´í„° ì €ì¥
    await this.saveBackupMetadata({
      id: backupId,
      type,
      size: fileSize,
      location: s3Location,
      status: "completed",
    });
  }

  // ë°±ì—… ìŠ¤ì¼€ì¤„
  setupBackupSchedule() {
    cron.schedule("0 2 * * *", () => this.performBackup("daily")); // ë§¤ì¼ ìƒˆë²½ 2ì‹œ
    cron.schedule("0 3 * * 0", () => this.performBackup("weekly")); // ì£¼ì¼ ìƒˆë²½ 3ì‹œ
    cron.schedule("0 4 1 * *", () => this.performBackup("monthly")); // ì›”ì´ˆ ìƒˆë²½ 4ì‹œ
  }
}
```

### ë°±ì—… ë³´ì¡´ ì •ì±…

- **ì¼ì¼ ë°±ì—…**: 7ì¼ ë³´ì¡´
- **ì£¼ê°„ ë°±ì—…**: 30ì¼ ë³´ì¡´
- **ì›”ê°„ ë°±ì—…**: 365ì¼ ë³´ì¡´
- **S3 Glacier**: ì¥ê¸° ì•„ì¹´ì´ë¸Œ (3ë…„)

## ğŸš¨ ì¬í•´ ë³µêµ¬ ê³„íš

### RTO/RPO ëª©í‘œ ê¸°ë°˜ ì„¤ê³„

```javascript
// disaster-recovery/drPlan.js
class DisasterRecoveryPlan {
  constructor() {
    this.rto = 4 * 60 * 60 * 1000; // 4ì‹œê°„ ë³µêµ¬ ëª©í‘œ
    this.rpo = 60 * 60 * 1000; // 1ì‹œê°„ ë°ì´í„° ì†ì‹¤ í—ˆìš©
  }

  // ìë™ í—¬ìŠ¤ì²´í¬
  setupHealthChecks() {
    const services = [
      { name: "primary-api", interval: 30000, retries: 3 },
      { name: "database", interval: 60000, retries: 2 },
      { name: "redis-cache", interval: 30000, retries: 3 },
      { name: "youtube-api", interval: 300000, retries: 1 },
    ];
  }

  // ì¥ì•  ìœ í˜•ë³„ ìë™ ëŒ€ì‘
  async handleServiceFailure(serviceName, error) {
    switch (serviceName) {
      case "primary-api":
        await this.initiateAPIFailover(); // ë¡œë“œë°¸ëŸ°ì„œ + DNS ì—…ë°ì´íŠ¸
        break;
      case "database":
        await this.initiateDatabaseFailover(); // ìŠ¤íƒ ë°”ì´ DB ìŠ¹ê²©
        break;
      case "redis-cache":
        await this.handleCacheFailure(); // ë©”ëª¨ë¦¬ ìºì‹œ í´ë°±
        break;
    }
  }
}
```

### í˜ì¼ì˜¤ë²„ ì‹œë‚˜ë¦¬ì˜¤

1. **API ì„œë²„ ì¥ì• **: ë¡œë“œë°¸ëŸ°ì„œ ìë™ ë¼ìš°íŒ… + ëŒ€ê¸° ì¸ìŠ¤í„´ìŠ¤ í™œì„±í™”
2. **ë°ì´í„°ë² ì´ìŠ¤ ì¥ì• **: ì½ê¸° ì „ìš© ëª¨ë“œ â†’ ìŠ¤íƒ ë°”ì´ DB ìŠ¹ê²©
3. **ì „ì²´ ì¥ì• **: DR ì‚¬ì´íŠ¸ í™œì„±í™” + DNS í˜ì¼ì˜¤ë²„
4. **ë„¤íŠ¸ì›Œí¬ ë¶„í• **: ì§€ì—­ë³„ ë…ë¦½ ìš´ì˜ ëª¨ë“œ

## ğŸ”„ ì§€ëŠ¥í˜• ë¡¤ë°± ì‹œìŠ¤í…œ

### ìë™ í—¬ìŠ¤ì²´í¬ ê¸°ë°˜ ë¡¤ë°±

```javascript
// deployment/rollbackStrategy.js
class RollbackStrategy {
  // ë°°í¬ í›„ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
  async monitorDeployment(deploymentId) {
    const config = {
      errorRateThreshold: 5, // 5% ì—ëŸ¬ìœ¨
      responseTimeThreshold: 2000, // 2ì´ˆ ì‘ë‹µì‹œê°„
      availabilityThreshold: 99, // 99% ê°€ìš©ì„±
      monitoringDuration: 600000, // 10ë¶„ ëª¨ë‹ˆí„°ë§
    };

    // 30ì´ˆë§ˆë‹¤ í—¬ìŠ¤ì²´í¬
    while (Date.now() < endTime) {
      const health = await this.performHealthChecks(deployment);

      if (
        health.errorRate > config.errorRateThreshold ||
        health.avgResponseTime > config.responseTimeThreshold ||
        health.availability < config.availabilityThreshold
      ) {
        // ìë™ ë¡¤ë°± ì‹¤í–‰
        await this.automaticRollback(deploymentId, health);
        break;
      }
    }
  }

  // ë§ˆì§€ë§‰ ì•ˆì • ë²„ì „ íƒì§€
  async findLastStableVersion(currentDeploymentId) {
    const deployments = this.deploymentHistory;

    for (const deployment of deployments) {
      if (deployment.status === "success") {
        // 1ì‹œê°„ ì´ìƒ ì•ˆì • ìš´ì˜ + ì—ëŸ¬ìœ¨ 1% ë¯¸ë§Œ
        const isStable = await this.verifyVersionStability(deployment);
        if (isStable) return deployment;
      }
    }
  }
}
```

### ì¹´ë‚˜ë¦¬ ë°°í¬ ì§€ì›

```javascript
// ì ì§„ì  íŠ¸ë˜í”½ ì „í™˜
async canaryDeployment(newVersion, percentage = 10) {
  // 1. 10% íŠ¸ë˜í”½ìœ¼ë¡œ ì‹œì‘
  await this.updateLoadBalancerWeights({
    current: 90,
    canary: 10
  });

  // 2. 30ë¶„ ëª¨ë‹ˆí„°ë§
  const metrics = await this.monitorCanaryDeployment(30 * 60 * 1000);

  // 3. ì„±ê³µ ì‹œ ì ì§„ì  í™•ëŒ€ (10% â†’ 25% â†’ 50% â†’ 100%)
  if (metrics.success) {
    await this.promoteCanaryDeployment();
  } else {
    await this.rollbackCanaryDeployment();
  }
}
```

## ğŸ”’ ë³´ì•ˆ ê°•í™” DevOps

### ì‹œí¬ë¦¿ ê´€ë¦¬ ì‹œìŠ¤í…œ

```javascript
// security/secretsManager.js
class SecretsManager {
  // HSM ì‹œë®¬ë ˆì´ì…˜ í‚¤ ê´€ë¦¬
  async generateMasterKey(keyId) {
    const key = crypto.randomBytes(32).toString("hex");

    // 90ì¼ ìë™ ë¡œí…Œì´ì…˜ ìŠ¤ì¼€ì¤„
    this.scheduleKeyRotation(keyId, 90 * 24 * 60 * 60 * 1000);

    return { keyId, created: new Date() };
  }

  // ëŸ°íƒ€ì„ ì‹œí¬ë¦¿ ë³µí˜¸í™”
  loadSecrets() {
    const encryptedSecrets = JSON.parse(process.env.ENCRYPTED_SECRETS);
    return this.decryptSecrets(encryptedSecrets);
  }
}
```

### ë³´ì•ˆ ìŠ¤ìº” ìë™í™”

- **ì˜ì¡´ì„± ì·¨ì•½ì **: npm audit, Snyk
- **ì»¨í…Œì´ë„ˆ ìŠ¤ìº”**: Trivy ì´ë¯¸ì§€ ìŠ¤ìº”
- **SAST**: SonarQube ì •ì  ë¶„ì„
- **DAST**: OWASP ZAP ë™ì  ìŠ¤ìº”

## ğŸ¯ í•µì‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°°í¬ ì „ í•„ìˆ˜ í™•ì¸

- [ ] **í™˜ê²½ë³€ìˆ˜**: ëª¨ë“  ì‹œí¬ë¦¿ ì•”í˜¸í™” ì €ì¥
- [ ] **ë°ì´í„°ë² ì´ìŠ¤**: ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ê²€ì¦
- [ ] **SSL/TLS**: ì¸ì¦ì„œ ìœ íš¨ì„± í™•ì¸
- [ ] **ë„ë©”ì¸**: DNS ë ˆì½”ë“œ ì„¤ì •
- [ ] **ëª¨ë‹ˆí„°ë§**: í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„

### ìš´ì˜ ì¤‘ ëª¨ë‹ˆí„°ë§

- [ ] **ê°€ìš©ì„±**: 99.9% SLA ìœ ì§€
- [ ] **ì„±ëŠ¥**: API ì‘ë‹µì‹œê°„ < 500ms
- [ ] **ì—ëŸ¬ìœ¨**: < 1% ìœ ì§€
- [ ] **ë¦¬ì†ŒìŠ¤**: CPU < 70%, ë©”ëª¨ë¦¬ < 80%
- [ ] **ë°±ì—…**: ì¼ì¼ ë°±ì—… ì„±ê³µ í™•ì¸

### ì¥ì•  ëŒ€ì‘ ì ˆì°¨

- [ ] **ì•Œë¦¼ í™•ì¸**: 5ë¶„ ì´ë‚´ ì¥ì•  ì¸ì§€
- [ ] **ì´ˆê¸° ëŒ€ì‘**: 15ë¶„ ì´ë‚´ ì„ì‹œ ì¡°ì¹˜
- [ ] **ê·¼ë³¸ í•´ê²°**: 4ì‹œê°„ ì´ë‚´ ì™„ì „ ë³µêµ¬
- [ ] **ì‚¬í›„ ë¶„ì„**: 24ì‹œê°„ ì´ë‚´ í¬ìŠ¤íŠ¸ëª¨í…œ
- [ ] **ê°œì„  ê³„íš**: 1ì£¼ì¼ ì´ë‚´ ì¬ë°œ ë°©ì§€ì±…

### ë³´ì•ˆ ìœ ì§€ ê´€ë¦¬

- [ ] **ì˜ì¡´ì„± ì—…ë°ì´íŠ¸**: ì£¼ 1íšŒ ì·¨ì•½ì  ìŠ¤ìº”
- [ ] **ë¡œê·¸ ë¶„ì„**: ì¼ì¼ ë³´ì•ˆ ì´ë²¤íŠ¸ ê²€í† 
- [ ] **ì ‘ê·¼ ì œì–´**: ì›” 1íšŒ ê¶Œí•œ ê²€í† 
- [ ] **ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸**: ë¶„ê¸° 1íšŒ ë³´ì•ˆ ì ê²€
- [ ] **ë°±ì—… ë³µêµ¬**: ì›” 1íšŒ ë³µêµ¬ í…ŒìŠ¤íŠ¸

### ì„±ëŠ¥ ìµœì í™”

- [ ] **CDN**: ì •ì  íŒŒì¼ ìºì‹± > 95%
- [ ] **ë°ì´í„°ë² ì´ìŠ¤**: ì¿¼ë¦¬ ì„±ëŠ¥ ìµœì í™”
- [ ] **API ìºì‹±**: Redis ì ì¤‘ë¥  > 85%
- [ ] **ì´ë¯¸ì§€ ìµœì í™”**: WebP í¬ë§· ì „í™˜
- [ ] **ë²ˆë“¤ ìµœì í™”**: JavaScript í¬ê¸° < 500KB

### ë¹„ìš© ìµœì í™”

- [ ] **ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰**: ì›”ê°„ ì‚¬ìš©ë¥  ë¶„ì„
- [ ] **ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤**: ë¯¸ì‚¬ìš© ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬
- [ ] **ìŠ¤í† ë¦¬ì§€ ì •ì±…**: ì˜¤ë˜ëœ ë°±ì—… ìë™ ì‚­ì œ
- [ ] **íŠ¸ë˜í”½ ë¶„ì„**: CDN ìºì‹œ íš¨ìœ¨ì„± ê°œì„ 
- [ ] **API ì‚¬ìš©ëŸ‰**: YouTube API ì¿¼í„° ìµœì í™”
