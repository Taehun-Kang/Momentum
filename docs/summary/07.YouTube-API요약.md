# 7. YouTube API í™œìš© ì „ëµ ìš”ì•½

> ìƒì„¸ ë¬¸ì„œ: [docs/basic/7.Youtube API í™œìš© ì „ëµ.md](../basic/7.Youtube%20API%20í™œìš©%20ì „ëµ.md)

## ğŸ¯ í•µì‹¬ ì„±ê³¼ ì§€í‘œ

### 90% API ì ˆì•½ ë©”ì»¤ë‹ˆì¦˜

```javascript
// âŒ ê¸°ì¡´ ë°©ì‹ (100% API ì†Œë¹„)
const searchResults = await youtube.search.list({
  q: "LCK í•˜ì´ë¼ì´íŠ¸",
  maxResults: 50,
}); // 100 units ì†Œë¹„

// âœ… ì§€ëŠ¥í˜• ì¿¼ë¦¬ ë¹Œë” (90% ì ˆì•½)
const brightDataContext = await brightData.callTool("search_web_trends", {
  query: "LCK í•˜ì´ë¼ì´íŠ¸",
  country: "KR",
});

// ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì±„ë„ ID ì¶”ì¶œ: LCK_Korea
const channelVideos = await youtube.videos.list({
  channelId: "UCCwbMDOOgC4Y8If0sYlLQAg",
  part: "snippet,contentDetails",
  maxResults: 50,
}); // 7 unitsë§Œ ì†Œë¹„ (93% ì ˆì•½!)
```

### ë¹„ìš© ëŒ€ë¹„ íš¨ê³¼

- **ì¼ì¼ ê²€ìƒ‰ ê°€ëŠ¥ëŸ‰**: 40-66íšŒ â†’ 400-600íšŒ (10ë°° ì¦ê°€)
- **ìºì‹œ ì ì¤‘ë¥ **: 85% ëª©í‘œ â†’ ì¶”ê°€ 90% ì ˆì•½
- **ì´ ì ˆì•½ë¥ **: 99.5% (90% + 85% ìºì‹œ)

## ğŸ—„ï¸ í• ë‹¹ëŸ‰ ë¶„ë°° ì „ëµ (10,000 units)

### 4-ì¹´í…Œê³ ë¦¬ ë¶„ë°°

```javascript
const quotaDistribution = {
  popular_keywords: {
    units: 2500, // 25%
    schedule: "daily at 03:00",
    strategy: "ìƒìœ„ 50ê°œ í‚¤ì›Œë“œ ì‚¬ì „ ìºì‹± (7-30ì¼)",
    efficiency: "200% ROI",
  },
  realtime_trends: {
    units: 2000, // 20%
    schedule: "every 4 hours",
    strategy: "Bright Data MCP + YouTube íŠ¸ë Œë“œ",
    refresh: "4ì‹œê°„ ìºì‹±",
  },
  premium_users: {
    units: 3500, // 35%
    schedule: "on demand",
    strategy: "AI ëŒ€í™”í˜• ê²€ìƒ‰ + ê°œì¸í™”",
    priority: "highest",
  },
  emergency_reserve: {
    units: 2000, // 20%
    schedule: "as needed",
    strategy: "80% ê²½ê³ , 90% ìºì‹œ ì „ìš© ëª¨ë“œ",
    fallback: "multiple_strategies",
  },
};
```

### API ë¹„ìš© ìµœì í™” ê³„ì‚°

```javascript
// ì •í™•í•œ ë¹„ìš© ê³„ì‚°
const apiCosts = {
  searchList: 100, // search.list
  videosListBasic: 1, // videos.list (id only)
  videosListWithParts: (parts) => 1 + parts.length * 2,
  // ì˜ˆ: part='snippet,contentDetails,status' = 1 + (3*2) = 7 units
};

// 2ë‹¨ê³„ í•„í„°ë§ ì´ ë¹„ìš©
const totalCost = 100 + 7; // 107 units per search
```

## ğŸ§  ì§€ëŠ¥í˜• ì¿¼ë¦¬ ë¹Œë” (90% ì ˆì•½ í•µì‹¬)

### Bright Data MCP ì—°ë™ ì›Œí¬í”Œë¡œìš°

```javascript
class IntelligentQueryBuilder {
  async buildEnhancedQuery(userQuery) {
    // 1. ì›¹ íŠ¸ë Œë“œ ë¶„ì„
    const context = await this.brightData.callTool("search_web_trends", {
      query: userQuery,
      country: "KR",
      sources: ["google_trends", "youtube_trending", "news"],
    });

    // 2. ì—”í‹°í‹° ì¶”ì¶œ ë° ì±„ë„ ë§¤í•‘
    const entities = this.extractEntities(context);
    const channels = this.mapToChannels(entities);

    // 3. ì±„ë„ë³„ ìµœì í™” ì¿¼ë¦¬ ìƒì„±
    return {
      // ê¸°ì¡´: search.list (100 units)
      searchQuery: this.buildSearchQuery(userQuery, context),

      // ìµœì í™”: videos.list (7 units)
      channelQueries: channels.map((channel) => ({
        channelId: channel.id,
        method: "videos.list",
        cost: 7,
        savings: "93%",
      })),
    };
  }

  // ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ
  examples = {
    lck_search: {
      input: "ìµœì‹  LCK í•˜ì´ë¼ì´íŠ¸",
      brightDataResult: ["T1", "Gen.G", "Faker", "Zeus"],
      channelMapping: {
        LCK_Korea: "UCCwbMDOOgC4Y8If0sYlLQAg",
        T1_Esports: "UCJ6ESJBWx8LNhGbW5zYNgwQ",
      },
      apiSavings: "93% (7 units vs 100 units)",
    },
    news_search: {
      input: "ì˜¤ëŠ˜ ì£¼ìš” ë‰´ìŠ¤",
      brightDataResult: ["ì •ì¹˜", "ê²½ì œ", "ì½”ë¡œë‚˜", "ë‚ ì”¨"],
      channelMapping: {
        MBC_News: "UCF4Wxdo3inmxP-Y59wXDsFw",
        SBS_News: "UCkinYTS9IHqOEwR1Sze2JTw",
      },
      apiSavings: "93%",
    },
  };
}
```

### ì¸ê¸° ì±„ë„ ì‚¬ì „ ì •ì˜ (í•µì‹¬ ì „ëµ)

```javascript
const POPULAR_CHANNELS = {
  gaming: {
    'lck': { id: 'UCCwbMDOOgC4Y8If0sYlLQAg', name: 'LCK Korea' },
    'faker': { id: 'UC0b8Zw2a7c8uF2eVYjXiNcQ', name: 'T1 Faker' },
    't1': { id: 'UCJ6ESJBWx8LNhGbW5zYNgwQ', name: 'T1 Esports' }
  },
  news: {
    'mbc': { id: 'UCF4Wxdo3inmxP-Y59wXDsFw', name: 'MBC News' },
    'sbs': { id: 'UCkinYTS9IHqOEwR1Sze2JTw', name: 'SBS News' },
    'jtbc': { id: 'UCsU-I-vHLiaMfV_ceaYz5rQ', name: 'JTBC News' }
  },
  music: {
    'hybe': { id: 'UC3IZKseVpdzPSBaWxBxundA', name: 'HYBE LABELS' },
    'jyp': { id: 'UCaO6TYtlC8U5ttz62hTrZgg', name: 'JYP Entertainment' },
    'sm': { id: 'UCEf_Bc-KVd7onSeifS3py9g', name: 'SMTOWN' }
  },
  food: {
    'paik': { id: 'UCyn-K7rZLXjGl7VXGweIlcA', name: 'ë°±ì¢…ì› PAIK JONG WON' },
    'korean_englishman': { id: 'UCyEd6QBSgat5kkC6svyjudA', name: 'Korean Englishman' }
  }
};

// ì±„ë„ í”„ë¦¬í˜ì¹­ ì „ëµ
async prefetchPopularChannels() {
  // ì¸ê¸° ì±„ë„ ìµœì‹  ì˜ìƒ ë¯¸ë¦¬ ìºì‹± (videos.list ì‚¬ìš©)
  const results = [];

  for (const category of Object.values(this.popularChannels)) {
    for (const channel of Object.values(category)) {
      const cached = await this.cacheChannelVideos(channel.id); // 7 units
      results.push(cached);
    }
  }

  return {
    cached: results.length,
    apiCost: results.length * 7,
    savings: '93% per future search'
  };
}
```

## ğŸ“Š 4-ë ˆë²¨ ìºì‹± ì „ëµ

### ê³„ì¸µë³„ ìºì‹± ì‹œìŠ¤í…œ

```javascript
class MultiLevelCache {
  levels = {
    L1: { type: "Memory", size: "100MB", ttl: "15min", hitRate: "90%" },
    L2: { type: "Redis", size: "1GB", ttl: "4hours", hitRate: "85%" },
    L3: { type: "Supabase", size: "10GB", ttl: "7days", hitRate: "70%" },
    L4: { type: "CDN", size: "Unlimited", ttl: "30days", hitRate: "95%" },
  };

  async get(key) {
    // L1: ë©”ëª¨ë¦¬ ìºì‹œ (15ë¶„)
    let data = this.memoryCache.get(key);
    if (data) return { data, source: "L1", cost: 0 };

    // L2: Redis ìºì‹œ (4ì‹œê°„)
    data = await this.redis.get(`cache:${key}`);
    if (data) {
      this.memoryCache.set(key, data); // L1ì— ìŠ¹ê²©
      return { data, source: "L2", cost: 0 };
    }

    // L3: ë°ì´í„°ë² ì´ìŠ¤ ìºì‹œ (7ì¼)
    data = await this.supabase
      .from("search_cache")
      .select("data")
      .eq("cache_key", key)
      .gt("expires_at", new Date());

    if (data) return { data, source: "L3", cost: 0 };

    // L4: API í˜¸ì¶œ í•„ìš”
    return { data: null, source: "API", cost: 107 };
  }

  // ì§€ëŠ¥í˜• TTL ì„¤ì •
  calculateTTL(key, data) {
    // ì¬ìƒ ê°€ëŠ¥ ì˜ìƒ: 7ì¼
    if (key.includes("playable:true")) return 7 * 24 * 60 * 60;

    // ì¬ìƒ ë¶ˆê°€ ì˜ìƒ: 1ì¼ (ì¬í™•ì¸ ë°©ì§€)
    if (key.includes("playable:false")) return 24 * 60 * 60;

    // ê²€ìƒ‰ ê²°ê³¼: 4ì‹œê°„
    if (key.includes("search:")) return 4 * 60 * 60;

    // íŠ¸ë Œë”©: 2ì‹œê°„
    if (key.includes("trending:")) return 2 * 60 * 60;

    return 3600; // ê¸°ë³¸ 1ì‹œê°„
  }
}
```

### ìºì‹œ ìµœì í™” ì„±ê³¼

- **ì „ì²´ ì ì¤‘ë¥ **: 85% ëª©í‘œ
- **L1 ë©”ëª¨ë¦¬**: 90% ì ì¤‘ë¥  (ì¦‰ì‹œ ì‘ë‹µ)
- **L2 Redis**: 85% ì ì¤‘ë¥  (< 50ms)
- **L3 Database**: 70% ì ì¤‘ë¥  (< 200ms)
- **í‰ê·  ì‘ë‹µ ì‹œê°„**: 150ms

## ğŸ” í• ë‹¹ëŸ‰ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

### ì‹¤ì‹œê°„ ì¶”ì  ë° ê²½ê³ 

```javascript
class QuotaMonitor {
  thresholds = {
    warning: 80, // 80% ì‚¬ìš© ì‹œ ê²½ê³ 
    critical: 90, // 90% ì‚¬ìš© ì‹œ ìºì‹œ ì „ìš© ëª¨ë“œ
    emergency: 95, // 95% ì‚¬ìš© ì‹œ ì™„ì „ ì°¨ë‹¨
  };

  async checkQuotaStatus() {
    const usage = this.quota.getTotalUsed();
    const percentage = (usage / 10000) * 100;

    if (percentage >= 90) {
      await this.enableCacheOnlyMode();
      await this.sendAlert("critical", { usage, percentage });
    } else if (percentage >= 80) {
      await this.sendAlert("warning", { usage, percentage });
    }

    // ë¹„ì •ìƒ ì‚¬ìš© íŒ¨í„´ ê°ì§€
    const expectedUsage = this.getExpectedUsage();
    if (usage > expectedUsage * 1.5) {
      await this.detectAnomaly(usage, expectedUsage);
    }

    return { usage, percentage, status: this.getStatus(percentage) };
  }

  // í´ë°± ì „ëµ
  async enableCacheOnlyMode() {
    global.CACHE_ONLY_MODE = true;

    // ëª¨ë“  ìƒˆë¡œìš´ API í˜¸ì¶œ ì°¨ë‹¨
    this.fallbackStrategy.activate([
      "exact_cache",
      "similar_cache",
      "stale_cache",
      "trending_fallback",
      "minimal_results",
    ]);
  }
}
```

### ì˜ˆìƒ ì‚¬ìš©ëŸ‰ íŒ¨í„´ (ì‹œê°„ëŒ€ë³„)

```javascript
const hourlyExpectedUsage = {
  "00-06": 200, // ìƒˆë²½ (ìºì‹œ ì›Œë°)
  "07-09": 500, // ì¶œê·¼ ì‹œê°„
  "10-12": 1000, // ì˜¤ì „ í”¼í¬
  "13-14": 1200, // ì ì‹¬ ì‹œê°„ í”¼í¬
  "15-17": 800, // ì˜¤í›„
  "18-20": 1400, // ì €ë… í”¼í¬ (ìµœëŒ€)
  "21-23": 1000, // ë°¤
};

// ì´ ì˜ˆìƒ ì‚¬ìš©ëŸ‰: ~8,100 units (80% ëª©í‘œ)
```

## ğŸ¬ Shorts í•„í„°ë§ ë° í’ˆì§ˆ í‰ê°€

### 2ë‹¨ê³„ í•„í„°ë§ í”„ë¡œì„¸ìŠ¤ (í•„ìˆ˜!)

```javascript
async function searchPlayableShorts(keyword) {
  // 1ë‹¨ê³„: í›„ë³´ ê²€ìƒ‰ (100 units)
  const searchResults = await youtube.search.list({
    q: keyword,
    type: "video",
    videoDuration: "short", // 4ë¶„ ì´í•˜
    maxResults: 50,
    regionCode: "KR",
  });

  // 2ë‹¨ê³„: ìƒì„¸ ì •ë³´ ë° ì¬ìƒ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ (7 units)
  const videoIds = searchResults.items.map((item) => item.id.videoId);
  const detailedVideos = await youtube.videos.list({
    part: "snippet,contentDetails,status,statistics",
    id: videoIds.join(","),
  });

  // 3ë‹¨ê³„: ì¬ìƒ ê°€ëŠ¥í•œ Shortsë§Œ í•„í„°ë§
  return detailedVideos.items.filter((video) => {
    const checks = {
      embeddable: video.status.embeddable,
      public: video.status.privacyStatus === "public",
      duration: parseDuration(video.contentDetails.duration) <= 60,
      notRegionBlocked: !isRegionBlocked(video, "KR"),
    };

    return Object.values(checks).every(Boolean);
  });
}

// ì´ ë¹„ìš©: 107 units (search: 100 + videos: 7)
```

### Shorts ê°ì§€ ì•Œê³ ë¦¬ì¦˜

```javascript
class ShortsDetector {
  criteria = {
    duration: { max: 60, weight: 0.3 },
    aspectRatio: { expected: 9 / 16, weight: 0.2 },
    title: { patterns: ["#shorts", "#short"], weight: 0.2 },
    url: { shortsPattern: true, weight: 0.3 },
  };

  async detectShorts(video) {
    const checks = {
      duration: this.checkDuration(video), // <= 60ì´ˆ
      aspectRatio: this.checkAspectRatio(video), // 9:16 ë¹„ìœ¨
      title: this.checkTitle(video), // #shorts íƒœê·¸
      url: this.checkURL(video), // /shorts/ URL ì§€ì›
    };

    // ê°€ì¤‘ ì ìˆ˜ ê³„ì‚°
    const score = Object.entries(checks).reduce((total, [key, result]) => {
      const weight = this.criteria[key].weight;
      return total + (result.isShorts ? weight : 0);
    }, 0);

    return {
      isShorts: score >= 0.6,
      confidence: score,
      checks,
      shortsURL: `https://youtube.com/shorts/${video.id}`,
    };
  }
}
```

### í’ˆì§ˆ í‰ê°€ ì‹œìŠ¤í…œ (S~D ë“±ê¸‰)

```javascript
class VideoQualityEvaluator {
  thresholds = {
    premium: 0.85, // Së“±ê¸‰
    recommended: 0.75, // Aë“±ê¸‰
    acceptable: 0.65, // Bë“±ê¸‰
    minimum: 0.5, // Cë“±ê¸‰ (Dë“±ê¸‰ì€ ë¯¸ë§Œ)
  };

  async evaluateVideoQuality(video) {
    const scores = {
      technical: await this.evaluateTechnicalQuality(video), // í•´ìƒë„, ì•ˆì •ì„±
      content: await this.evaluateContentQuality(video), // ì œëª©, ì„¤ëª…, íƒœê·¸
      engagement: await this.evaluateEngagementQuality(video), // ì¢‹ì•„ìš”, ëŒ“ê¸€
      channel: await this.evaluateChannelQuality(video), // êµ¬ë…ì, ì‹ ë¢°ë„
    };

    const overallScore = Object.values(scores).reduce((a, b) => a + b) / 4;
    const grade = this.determineGrade(overallScore);

    return {
      passed: overallScore >= this.thresholds.minimum,
      score: overallScore,
      grade,
      scores,
      recommendations: this.getRecommendations(scores),
    };
  }

  determineGrade(score) {
    if (score >= 0.85) return "S";
    if (score >= 0.75) return "A";
    if (score >= 0.65) return "B";
    if (score >= 0.5) return "C";
    return "D";
  }
}
```

## ğŸš¨ í´ë°± ì „ëµ (í• ë‹¹ëŸ‰ ì´ˆê³¼ ì‹œ)

### 5ë‹¨ê³„ í´ë°± ì‹œìŠ¤í…œ

```javascript
const fallbackStrategies = {
  1: {
    name: 'exact_cache',
    description: 'ì •í™•í•œ ìºì‹œ ë§¤ì¹­',
    success_rate: '95%'
  },
  2: {
    name: 'similar_cache',
    description: 'ìœ ì‚¬ ê²€ìƒ‰ì–´ ìºì‹œ',
    success_rate: '80%'
  },
  3: {
    name: 'stale_cache',
    description: 'ë§Œë£Œëœ ìºì‹œ ì‚¬ìš© (24ì‹œê°„ ì´ë‚´)',
    success_rate: '70%'
  },
  4: {
    name: 'trending_fallback',
    description: 'ê´€ë ¨ íŠ¸ë Œë”© ì½˜í…ì¸ ',
    success_rate: '60%'
  },
  5: {
    name: 'minimal_results',
    description: 'ê¸°ë³¸ ì¸ê¸° ì½˜í…ì¸ ',
    success_rate: '100%'
  }
};

async handleQuotaExceeded(request) {
  for (const strategy of this.strategies) {
    const result = await strategy.execute(request);
    if (result.success) {
      // ì‚¬ìš©ìì—ê²Œ í´ë°± ì‚¬ìš© ì•Œë¦¼
      result.notification = this.getFallbackNotification(strategy.name);
      return result;
    }
  }

  // ëª¨ë“  ì „ëµ ì‹¤íŒ¨
  return this.getFailureResponse(request);
}
```

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™” ê²°ê³¼

### API ì‚¬ìš©ëŸ‰ ìµœì í™”

- **ê¸°ì¡´**: 10,000 units = 40-66íšŒ ê²€ìƒ‰
- **ìµœì í™” í›„**: 10,000 units = 400-600íšŒ ê²€ìƒ‰ (10ë°° ì¦ê°€)
- **ìºì‹œ ì ìš©**: 85% ì ì¤‘ë¥  â†’ ì‹¤ì§ˆì ìœ¼ë¡œ 2,667-4,000íšŒ ê²€ìƒ‰

### ì‘ë‹µ ì‹œê°„ ê°œì„ 

- **ìºì‹œ íˆíŠ¸**: < 150ms
- **API í˜¸ì¶œ**: < 500ms
- **í´ë°± ëª¨ë“œ**: < 200ms
- **í‰ê·  ì‘ë‹µ**: 180ms

### ë¹„ìš© íš¨ìœ¨ì„±

- **ì¼ì¼ ìš´ì˜ë¹„**: $0 (ë¬´ë£Œ í• ë‹¹ëŸ‰ ë‚´)
- **ìœ ë£Œ ì‹œ**: $0.01 per 1000 requests
- **ì—°ê°„ ì˜ˆìƒ ë¹„ìš©**: $365 (í•˜ë£¨ $1)

## ğŸ¯ í•µì‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### í•„ìˆ˜ êµ¬í˜„ ì‚¬í•­

- [ ] **2ë‹¨ê³„ í•„í„°ë§**: search.list â†’ videos.list â†’ ì¬ìƒ ê°€ëŠ¥ í™•ì¸
- [ ] **ì§€ëŠ¥í˜• ì¿¼ë¦¬**: Bright Data MCP ì—°ë™ìœ¼ë¡œ 90% API ì ˆì•½
- [ ] **ì±„ë„ í”„ë¦¬í˜ì¹­**: ì¸ê¸° ì±„ë„ ì‚¬ì „ ìºì‹±
- [ ] **4-ë ˆë²¨ ìºì‹±**: 85% ì ì¤‘ë¥  ëª©í‘œ
- [ ] **í• ë‹¹ëŸ‰ ëª¨ë‹ˆí„°ë§**: 80% ê²½ê³ , 90% ìºì‹œ ì „ìš©

### í’ˆì§ˆ ê´€ë¦¬

- [ ] **Shorts ê°ì§€**: 60ì´ˆ ì´í•˜, 9:16 ë¹„ìœ¨, #shorts íƒœê·¸
- [ ] **í’ˆì§ˆ í‰ê°€**: S~D ë“±ê¸‰ ì‹œìŠ¤í…œ (50% ì´ìƒë§Œ í†µê³¼)
- [ ] **ì¬ìƒ ê°€ëŠ¥**: embeddable, public, ì§€ì—­ ì°¨ë‹¨ í•´ì œ
- [ ] **ì½˜í…ì¸  í•„í„°**: ë¶€ì ì ˆí•œ ì½˜í…ì¸  ìë™ ì œì™¸

### ëª¨ë‹ˆí„°ë§ ì§€í‘œ

- [ ] **API ì‚¬ìš©ë¥ **: < 80% ì¼ì¼ í• ë‹¹ëŸ‰
- [ ] **ìºì‹œ ì ì¤‘ë¥ **: > 85%
- [ ] **í•„í„°ë§ ì„±ê³µë¥ **: > 70%
- [ ] **ì‘ë‹µ ì‹œê°„**: < 500ms
- [ ] **ì‚¬ìš©ì ë§Œì¡±ë„**: > 4.0/5.0
